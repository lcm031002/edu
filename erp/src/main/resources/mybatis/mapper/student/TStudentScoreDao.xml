<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.erp.dao.TStudentScoreDao">
	<select id="queryByApplyId" parameterType="java.lang.Long"
		resultType="com.edu.erp.model.TStudentScore">
		select tss.id,
		       tss.apply_id     as applyId,
		       tss.subject_id   as subjectId,
		       tss.subject_name as subjectName,
		       tss.score,
		       tss.full_mark    as fullMark
		  from t_student_score tss
		 where tss.apply_id = #{applyId, jdbcType=NUMERIC}
	</select>

	<insert id="save" parameterType="com.edu.erp.model.TStudentScore">
		insert into t_student_score
		(
		apply_id,
		subject_id,
		subject_name,
		score,
		full_mark,
		create_user,
		create_time
		)
		values
		(
		#{applyId, jdbcType=NUMERIC},
		#{subjectId, jdbcType=NUMERIC},
		#{subjectName, jdbcType=VARCHAR},
		#{score, jdbcType=NUMERIC},
		#{fullMark, jdbcType=NUMERIC},
		#{create_user, jdbcType=NUMERIC},
		#{create_time, jdbcType=TIMESTAMP}
		)
	</insert>
	
	<insert id="saveList" parameterType="java.util.List">
		<foreach collection="list" item="item" index="index" open="begin" close="; end;" separator=";">
			insert into t_student_score
			(
			apply_id,
			subject_id,
			subject_name,
			score,
			full_mark,
			create_user,
			create_time
			)
			values
			(
			#{item.applyId, jdbcType=NUMERIC},
			#{item.subjectId, jdbcType=NUMERIC},
			#{item.subjectName, jdbcType=VARCHAR},
			#{item.score, jdbcType=NUMERIC},
			#{item.fullMark, jdbcType=NUMERIC},
			#{item.create_user, jdbcType=NUMERIC},
			#{item.create_time, jdbcType=TIMESTAMP}
			)
		</foreach>
	</insert>

	<update id="update" parameterType="com.edu.erp.model.TStudentScore">
		update t_student_score
		set 
		<if test="subjectId != null">
			subject_id = #{subjectId, jdbcType=NUMERIC},
		</if>
		<if test="subjectName != null and subjectName != ''">
			subject_name = #{subjectName, jdbcType=VARCHAR},
		</if>
		<if test="score != null">
			score = #{score, jdbcType=NUMERIC},
		</if>
		<if test="fullMark != null">
			full_mark = #{fullMark, jdbcType=NUMERIC},
		</if>
			update_user = #{update_user, jdbcType=NUMERIC},
			update_time = #{update_time, jdbcType=TIMESTAMP}
		where id = #{id, jdbcType=NUMERIC}
	</update>

	<delete id="deleteById" parameterType="java.lang.Long">
		delete from t_student_score where id = #{id, jdbcType=NUMERIC}
	</delete>

	<delete id="deleteByApplyId" parameterType="java.lang.Long">
		delete from t_student_score where apply_id = #{applyId, jdbcType=NUMERIC}
	</delete>
	
	<select id="isStuScoreExisted" parameterType="com.edu.erp.model.TStudentScore" resultType="java.lang.Integer">
		select count(0)
		  from t_student_score tss
		 where tss.subject_id = #{subjectId}
		   and tss.apply_id = #{applyId}
		 <if test="id != null">
		   and tss.id != #{id}
		 </if>
	</select>

</mapper>