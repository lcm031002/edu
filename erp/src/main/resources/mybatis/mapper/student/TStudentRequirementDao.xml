<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.erp.dao.TStudentRequirementDao">
	<select id="queryByApplyId" parameterType="java.lang.Long"
		resultType="com.edu.erp.model.TStudentRequirement">
		select tsr.id,
		       tsr.apply_id as applyId,
		       tsr.subject_id as subjectId,
		       tsr.subject_name as subjectName,
		       tsr.requirement,
		       tsr.seq
		  from t_student_requirement tsr
		 where tsr.apply_id = #{applyId, jdbcType=NUMERIC}
	</select>

	<insert id="save" parameterType="com.edu.erp.model.TStudentRequirement">
		<selectKey resultType="java.lang.Long" keyProperty="id"
			order="BEFORE">
			select seq_t_student_requirement.nextval as id from dual
		</selectKey>
		insert into t_student_requirement
		(id,
		apply_id,
		subject_id,
		subject_name,
		requirement,
		seq,
		teach_group_id,
		create_user,
		create_time
		)
		values
		(
		#{id, jdbcType=NUMERIC},
		#{applyId, jdbcType=NUMERIC},
		#{subjectId, jdbcType=NUMERIC},
		#{subjectName, jdbcType=VARCHAR},
		#{requirement, jdbcType=NUMERIC},
		#{seq, jdbcType=NUMERIC},
		#{teachGroupId, jdbcType=NUMERIC},
		#{create_user, jdbcType=NUMERIC},
		#{create_time, jdbcType=TIMESTAMP}
		)
	</insert>
	
	<insert id="saveList" parameterType="java.util.List">
		<foreach collection="list" item="item" index="index" open="begin" close="; end;" separator=";">
			insert into t_student_requirement
			(id,
			apply_id,
			subject_id,
			subject_name,
			requirement,
			seq,
			teach_group_id,
			create_user,
			create_time
			)
			values
			(
			seq_t_student_requirement.nextval,
			#{item.applyId, jdbcType=NUMERIC},
			#{item.subjectId, jdbcType=NUMERIC},
			#{item.subjectName, jdbcType=VARCHAR},
			#{item.requirement, jdbcType=NUMERIC},
			#{item.seq, jdbcType=NUMERIC},
			#{item.teachGroupId, jdbcType=NUMERIC},
			#{item.create_user, jdbcType=NUMERIC},
			#{item.create_time, jdbcType=TIMESTAMP}
			)
		</foreach>
	</insert>

	<update id="update" parameterType="com.edu.erp.model.TStudentRequirement">
		update t_student_requirement
		set 
		<if test="subjectId != null">
			subject_id = #{subjectId, jdbcType=NUMERIC},
		</if>
		<if test="subjectName != null and subjectName != ''">
			subject_name = #{subjectName, jdbcType=VARCHAR},
		</if>
		<if test="requirement != null">
			requirement = #{requirement, jdbcType=NUMERIC},
		</if>
		<if test="seq != null">
			seq = #{seq, jdbcType=NUMERIC},
		</if>
		<if test="teachGroupId != null">
			teach_group_id = #{teachGroupId, jdbcType=NUMERIC},
		</if>
			update_user = #{update_user, jdbcType=NUMERIC},
			update_time = #{update_time, jdbcType=TIMESTAMP}
		where id = #{id,jdbcType=NUMERIC}
	</update>

	<delete id="deleteById" parameterType="java.lang.Long">
		delete from t_student_requirement where id = #{id, jdbcType=NUMERIC}
	</delete>

	<delete id="deleteByApplyId" parameterType="java.lang.Long">
		delete from t_student_requirement where apply_id = #{applyId, jdbcType=NUMERIC}
	</delete>
	
	<select id="isStuReqExisted" parameterType="com.edu.erp.model.TStudentRequirement" resultType="java.lang.Integer">
		select count(0)
		  from t_student_requirement tsr
		 where tsr.subject_id = #{subjectId}
		   and tsr.apply_id = #{applyId}
		 <if test="id != null">
		   and tsr.id != #{id}
		 </if>
	</select>

	<select id="isSeqExisted" parameterType="com.edu.erp.model.TStudentRequirement" resultType="java.lang.Integer">
		select count(0)
		from t_student_requirement tsr
		where tsr.seq = #{seq}
		and tsr.apply_id = #{applyId}
		<if test="id != null">
			and tsr.id != #{id}
		</if>
	</select>

	<select id="hasStuReq" parameterType="long" resultType="integer">
		select count(0)
		from t_student_requirement tsr
		where tsr.apply_id = #{applyId}
	</select>

</mapper>