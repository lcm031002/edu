<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.erp.dao.PayFlowDao">
	<resultMap id="teamMap" type="java.util.HashMap">
		<result column="buId" property="buId" javaType="string" />
		<result column="name" property="name" javaType="string" />
	</resultMap>
	
	<select id="queryPayFlow" parameterType="java.util.Map"
	resultType="com.edu.erp.model.PayFlowInfo" statementType="STATEMENT">
		select *
		from ( select tmp_page.*, rownum row_id
				from (select p_f.id,
					       p_f.pay_orderid,
					       p_f.student_id,
					       p_f.student_encoding,
					       p_f.student_name,
					       p_f.pay_wechat,
					       p_f.acc_no,
					       p_f.pay_way,
					       decode(p_f.pay_way, 1, '银联在线', 2, '支付宝', 3, '微信支付') as pay_way_name,
					       p_f.create_time as pay_time,
					       p_f.pay_amount,
					       p_f.pay_phone,
					       p_f.remark,
					       p_f.mer_id,
					       pam.marname as mer_name
					from ${tableName} p_f
					left join pay_acount_mgt pam on p_f.mer_id = pam.id
					where p_f.pay_status=3
					<if test="keyWord != null and keyWord != ''">
						and p_f.student_name like '%${keyWord}%'
					</if>
					<if test="beginDate != null and beginDate != '' ">
						and p_f.create_time &gt;= ${beginDate} || ' 00:00:00'
					</if>
					<if test="endDate != null and endDate != '' ">
						and p_f.create_time &lt;= ${endDate} || ' 23:59:59'
					</if>
					)tmp_page
				<if test="rownum != null and rownum != '' ">
					where rownum &lt;= ${rownum}
				</if>
				)
		<if test="row_id != null and row_id != '' ">
			where row_id &gt; ${row_id}
		</if>
		
	</select>
	
	<select id="queryTeam" parameterType="java.lang.Long" resultMap="teamMap">
		select bu_id as buId,marfullname as name 
		from pay_acount_mgt
		where id in (select max(id) from pay_acount_mgt group by bu_id)
		and bu_id != 11
		and bu_id = #{buId}
	</select>
	
	<select id="queryTotalAmount" parameterType="java.util.Map"
		resultType="java.lang.Double" statementType="STATEMENT">
		select sum(p_f.pay_amount) as total
		from ${tableName} p_f
		where p_f.pay_status=3
		<if test="keyWord != null and keyWord != ''">
			and p_f.student_name like '%${keyWord}%'
		</if>
		<if test="beginDate != null and beginDate != '' ">
			and p_f.create_time &gt;= ${beginDate} || ' 00:00:00'
		</if>
		<if test="endDate != null and endDate != '' ">
			and p_f.create_time &lt;= ${endDate} || ' 23:59:59'
		</if>
	</select>

</mapper>