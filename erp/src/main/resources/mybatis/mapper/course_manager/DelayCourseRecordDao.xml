<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.erp.dao.DelayCourseRecordDao">
    <select id="listDelayCourseRecord" resultType="com.edu.erp.course_manager.business.DelayCourseRecord">
        select
          tcr.id,
          tcr.delay_course_num delayCourseNum,
          tcr.create_time createTime,
          tcr.create_user createUser,
          ei.employee_name createUserName,
          tcr.delay_course_date delayCourseDate,
          tcr.reason,
          tcr.error,
          tcr.bu_id buId
        from tab_delay_course_record tcr
        join tab_user_info ui on tcr.create_user = ui.id
        left join tab_employee_info ei on ui.employee_id = ei.id
        where tcr.bu_id = #{bu_id,jdbcType=NUMERIC}
        <if test="createUser!= null">
           and ei.id = #{createUser}
        </if>
        <if test="createDate != null and createDate != '' ">
           and to_char(tcr.create_time,'yyyy-MM-dd') = #{createDate}
        </if>
        <if test="delayCourseDate!=null and delayCourseDate != '' ">
           and tcr.delay_course_date = #{delayCourseDate}
        </if>
        order by tcr.create_time desc
    </select>

</mapper>