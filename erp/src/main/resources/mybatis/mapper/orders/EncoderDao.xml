<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.erp.dao.EncoderDao">
	
	<!-- 保存单据 -->
	<insert id="saveEncoder" parameterType="com.edu.erp.model.TEncoder">
		<selectKey resultType="java.lang.Long" keyProperty="id" order="BEFORE">
			select  SEQ_T_ENCODER.nextval as id from dual
		</selectKey>
		insert into t_encoder
	      (id, 
	       encoder_no, 
	       encoder_type, 
	       fee_flag, 
	       order_id, 
	       encoder_notice, 
	       busi_type, 
	       busi_id, 
	       create_user, 
	       create_time, 
	       update_user, 
	       update_time, 
	       confirm_time, 
	       status, 
	       fee_amount 
	       )
    values
	      ( 
	      #{id,jdbcType=NUMERIC},
		  'ENCODER'||#{id,jdbcType=NUMERIC},
		  #{encoder_type,jdbcType=NUMERIC},
		  #{fee_flag,jdbcType=NUMERIC},
		  #{order_id,jdbcType=NUMERIC},
		  #{encoder_notice,jdbcType=VARCHAR},
		  #{busi_type,jdbcType=NUMERIC},
		  #{busi_id,jdbcType=NUMERIC},
		  #{create_user,jdbcType=NUMERIC},
		  #{create_time,jdbcType=TIMESTAMP},
		  #{update_user,jdbcType=NUMERIC},
		  #{update_time,jdbcType=TIMESTAMP},
		  #{confirm_time,jdbcType=TIMESTAMP},
		  #{status,jdbcType=NUMERIC},
		  #{fee_amount,jdbcType=NUMERIC}
	       )
	</insert>
	
	<select  id="queryEncoderInfo" resultType="com.edu.erp.model.TEncoder" parameterType="com.edu.erp.model.TEncoder">
		select
		   id, 
	       encoder_no, 
	       encoder_type, 
	       fee_flag, 
	       order_id, 
	       encoder_notice, 
	       busi_type, 
	       busi_id, 
	       create_user, 
	       create_time, 
	       update_user, 
	       update_time, 
	       confirm_time, 
	       status, 
	       fee_amount 
	    from t_encoder where  1=1 
		<if test="busi_type != null and busi_type != ''">
		 	and	busi_type = #{busi_type}
		 </if>
		 <if test="busi_id != null and busi_id != ''">
		 	and	busi_id = #{busi_id}
		 </if>
		 <if test="order_id != null and order_id != ''">
		 	and	order_id = #{order_id}
		 </if>
	</select>
	
	<update id="updateEncoderStatus" parameterType="com.edu.erp.model.TEncoder">
		update t_encoder t set t.status = #{status,jdbcType=NUMERIC} where t.busi_id = #{order_id,jdbcType=NUMERIC} and busi_type= #{busi_type,jdbcType=NUMERIC}
	</update>
	<!-- 确认单据 -->
	<update id="updateEncoderById" parameterType="com.edu.erp.model.TEncoder">
		update t_encoder t set t.confirm_time = #{confirm_time},t.update_user  = #{update_user},t.update_time  = #{confirm_time},t.status = #{status,jdbcType=NUMERIC} 
		where t.id = #{id,jdbcType=NUMERIC} 
	</update>
	
	
	
</mapper>