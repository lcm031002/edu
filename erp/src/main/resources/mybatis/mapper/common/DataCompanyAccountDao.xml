<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.erp.dao.DataCompanyAccountDao">
	<!--查询公司的账户号信息 -->
	<select id="selectForPage" resultType="com.edu.erp.model.DataCompanyAccount"
		parameterType="java.util.Map">
		select tdca.id,
				tdca.account_name,
				tdca.account_num,
				tdca.description,
				tdca.status,
				tdca.create_time,
				tdca.update_time,
				(case tdca.status when 0 then '删除' when 1 then '有效' when 2 then '无效' end) statusstr,
				tdca.id as company_card_id,
				emp.employee_name create_user_name,
				tdca.create_user,
				tdca.update_user,
				upemp.employee_name update_user_name,
				concat(concat(tdca.account_name, '('), concat(tdca.account_num, ')')) as account_info
		from tab_data_company_account tdca
		left join tab_user_info us
		on tdca.create_user = us.id
		left join tab_employee_info emp
		on us.employee_id = emp.id
		left join tab_user_info upus
		on tdca.update_user = upus.id
		left join tab_employee_info upemp
		on upus.employee_id = upemp.id
		where tdca.STATUS != 0
		  and tdca.org_city_id = #{city_id}
		<if test="account_name != null and account_name != ''">
			and tdca.account_name like '%' || #{account_name} || '%'
		</if>
		<if test="account_num != null and account_num != ''">
			and tdca.account_num like '%' || #{account_num} || '%'
		</if>
		<if test="status != null and status != 0">
			and tdca.STATUS =#{status,jdbcType=NUMERIC}
		</if>
		ORDER BY tdca.update_time DESC, tdca.id desc
	</select>

	<!--下拉列表 -->
	<select id="selectList" parameterType="map"
		resultType="com.edu.erp.model.DataCompanyAccount">
		select tdca.id,
				tdca.account_name,
				tdca.account_num,
				tdca.description,
				tdca.org_city_id as city_id,
				tdca.create_time,
				tdca.update_time,
				tdca.status,
				(case tdca.status when 0 then '删除' when 1 then '有效' when 2 then '无效' end) statusstr,
				tdca.create_user,
				tdca.update_user,
				concat(concat(tdca.account_name, '('), concat(tdca.account_num, ')')) as account_info
		from tab_data_company_account tdca
		where tdca.status = 1
		<if test="city_id != null">
			and tdca.org_city_id = #{city_id}
		</if>
		order by tdca.id DESC
	</select>

	<insert id="insert" parameterType="com.edu.erp.model.DataCompanyAccount" useGeneratedKeys="true" keyProperty="id">
		INSERT INTO tab_data_company_account
		(
		account_name,
		account_num,
		status,
		description,
		org_city_id,
		create_user,
		create_time
		)
		VALUES
		(
		#{account_name,jdbcType=VARCHAR},
		#{account_num,jdbcType=VARCHAR},
		#{status,jdbcType=NUMERIC},
		#{description,jdbcType=VARCHAR},
		#{city_id,jdbcType=NUMERIC},
		#{create_user,jdbcType=NUMERIC},
		#{create_time,jdbcType=TIMESTAMP}
		)
	</insert>

	<update id="update" parameterType="com.edu.erp.model.DataCompanyAccount">
		UPDATE tab_data_company_account SET
		account_num = #{account_num,jdbcType=VARCHAR},
		account_name = #{account_name,jdbcType=VARCHAR},
		description = #{description,jdbcType=VARCHAR},
		status = #{status,jdbcType=VARCHAR},
		update_user = #{update_user,jdbcType=NUMERIC},
		update_time = #{update_time,jdbcType=TIMESTAMP}
		WHERE id = #{id}
	</update>

	<update id="deleteById" parameterType="long">
		UPDATE
		tab_data_company_account SET STATUS = 0 WHERE ID = #{id}
	</update>

</mapper>