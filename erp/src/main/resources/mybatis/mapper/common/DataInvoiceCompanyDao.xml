<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.erp.dao.DataInvoiceCompanyDao">

	<!-- 查询开票单位信息列表 -->
	<select id="selectPage" resultType="com.edu.erp.model.DataInvoiceCompany"
		parameterType="java.util.Map">
		select a.id,
				a.company_name,
				a.description,
				a.status,
				a.org_city_id as city_id,
				a.create_user,
				a.create_time,
				a.update_user,
				a.update_time,
				c_emp.employee_name as create_user_name, u_emp.employee_name as update_user_name,
				toi.org_name as city_name
		from tab_data_invoice_company a
		left join on tab_organization_info toi on toi.id = a.org_city_id
		<!-- 新增用户 -->
		left join tab_user_info c_user on a.create_user = c_user.id
		left join
		tab_employee_info c_emp on c_user.employee_id = c_emp.id
		<!-- 修改用户 -->
		left join tab_user_info u_user on a.update_user = u_user.id
		left join
		tab_employee_info u_emp on u_user.employee_id = u_emp.id
		where a.status != 0
		  and a.org_city_id = #{city_id}
		<if test="company_name != null and company_name != ''">
			AND a.company_name like '%${company_name}%'
		</if>
		order by a.update_time DESC, a.id DESC
	</select>
	
	<!-- 查询开票单位信息列表 -->
	<select id="selectList" resultType="com.edu.erp.model.DataInvoiceCompany"
		parameterType="java.util.Map">
		select a.id,
				a.company_name,
				a.description,
				a.status,
				a.org_city_id as city_id,
				a.create_user,
				a.create_time,
				a.update_user,
				a.update_time,
				c_emp.employee_name as create_user_name, u_emp.employee_name as update_user_name
		from tab_data_invoice_company a
		<!-- 新增用户 -->
		left join tab_user_info c_user on a.create_user = c_user.id
		left join
		tab_employee_info c_emp on c_user.employee_id = c_emp.id
		<!-- 修改用户 -->
		left join tab_user_info u_user on a.update_user = u_user.id
		left join tab_employee_info u_emp on u_user.employee_id = u_emp.id
		where a.status = 1
		  and a.org_city_id = #{city_id}
		order by a.update_time DESC, a.id DESC
	</select>

	<!-- 插入开票单位数据 -->
	<insert id="save" parameterType="com.edu.erp.model.DataInvoiceCompany" useGeneratedKeys="true" keyProperty="id">
		insert into tab_data_invoice_company
		(
		company_name,
		description,
		org_city_id,
		create_user,
		create_time,
		update_user,
		update_time,
		status
		)
		values
		(
		#{company_name,jdbcType=VARCHAR},
		#{description,jdbcType=VARCHAR},
		#{city_id,jdbcType=NUMERIC},
		#{create_user,jdbcType=NUMERIC},
		#{create_time,jdbcType=TIMESTAMP},
		#{update_user,jdbcType=NUMERIC},
		#{update_time,jdbcType=TIMESTAMP},
		#{status,jdbcType=NUMERIC}
		)
	</insert>

	<!-- 更新开票单位数据 -->
	<update id="update" parameterType="com.edu.erp.model.DataInvoiceCompany">
		update tab_data_invoice_company set
			company_name = #{company_name,jdbcType=VARCHAR},
			description = #{description,jdbcType=VARCHAR},
			update_user = #{update_user,jdbcType=NUMERIC},
			update_time = #{update_time,jdbcType=TIMESTAMP}
		WHERE id = #{id}
	</update>

	<!-- 更新开票单位状态 -->
	<update id="changeStatus" parameterType="java.util.Map">
		update tab_data_invoice_company t
		set t.status = ${status}
		where t.id in (${ids})
	</update>
</mapper>