<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.erp.dao.MakeupDao">
	<!-- 查询 某个课程中的某个课次的所有学员的补课信息 -->
	<select id="querySchedulingAttendanceMakeupByForCourse"
		resultType="com.edu.erp.model.Makeup" parameterType="map">
		select
		t.activation_code as act_code,
		to_char(t.valid_start_date,
		'yyyy-mm-dd') as vs_date,
		to_char(t.valid_end_date, 'yyyy-mm-dd') as
		ve_date,
		to_char(t.start_time, 'yyyy-mm-dd') as active_time,
		case
		when
		t.status = 0 then
		'无效'
		else
		'有效'
		end as status_name,
		tcs.course_times as
		course_times,
		tc.course_name as course_name,
		case
		when tcs.attended = 'Y'
		then
		'已考勤'
		else
		'未考勤'
		end as
		attended

		from T_COURSE_SCHEDULING tcs
		right join
		T_EL_INFO t
		on
		t.scheduling_id =
		tcs.id
		left join T_COURSE tc
		on
		tcs.course_id = tc.id
		where
		tcs.course_id= #{courseId}
		and
		tcs.course_times = #{courseTime}
		and
		tcs.branch_id = #{branchId}
		<if test="startDate!=null and startDate!=''">
			and t.valid_start_date
			&gt;=to_date(#{startDate},'yyyy-mm-dd')
		</if>
		<if test="endDate!=null and endDate!=''">
			and t.valid_end_date
			&lt;=to_date(#{endDate},'yyyy-mm-dd')
		</if>
		order by t.valid_start_date,t.valid_end_date asc 
	</select>
	<!-- 根据学员的id查询该学员的所有补课信息 -->
	<select id="querySchedulingAttendanceMakeupForStu" resultType="com.edu.erp.model.Makeup"
		parameterType="map">
		select t.activation_code as act_code,
		to_char(t.valid_start_date,
		'yyyy-mm-dd') as vs_date,
		to_char(t.valid_end_date, 'yyyy-mm-dd') as
		ve_date,
		to_char(t.start_time, 'yyyy-mm-dd') as active_time,
		case
		when
		t.status =
		0 then
		'无效'
		else
		'有效'
		end as status_name,
		tcs.course_times as
		course_times,
		tc.course_name as course_name,
		case
		when tcs.attended = 'Y'
		then
		'已考勤'
		else
		'未考勤'
		end as
		attended
		from T_EL_INFO t
		left join
		T_COURSE_SCHEDULING
		tcs
		on t.scheduling_id =
		tcs.id
		left join T_COURSE tc
		on tcs.course_id =
		tc.id
		where t.student_id
		= #{studentId} and
		tcs.branch_id=#{branchId}
		<if test="startDate!=null and startDate!=''">
			and t.valid_start_date
			&gt;=to_date(#{startDate},'yyyy-mm-dd')
		</if>
		<if test="endDate!=null and endDate!=''">
			and t.valid_end_date
			&lt;=to_date(#{endDate},'yyyy-mm-dd')
		</if>
		order by t.valid_start_date,t.valid_end_date asc 
	</select>
</mapper>