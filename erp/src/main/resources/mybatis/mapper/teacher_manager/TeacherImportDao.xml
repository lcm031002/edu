<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.edu.erp.dao.TeacherImportDao">

	<select id="queryExistEncoding" parameterType="java.util.Set" resultType="java.lang.String">
		select distinct encoding from tab_teacher_info where 
		status != 0
		and city_id = #{city_id}
		and encoding in 
		  <foreach item="item" index="index" collection="encodingSet"
		      open="(" separator="," close=")">
		        #{item,jdbcType=VARCHAR}
		  </foreach>	
	</select>
	
	<select id="queryExistPhone" parameterType="java.util.Set" resultType="java.lang.String">
		select distinct phone from tab_teacher_info where 
		status != 0
		and city_id = #{city_id}
		and phone in 
		  <foreach item="item" index="index" collection="encodingSet"
		      open="(" separator="," close=")">
		        #{item,jdbcType=VARCHAR}
		  </foreach>	
	</select>
	
	<select id="queryEmployeeNameEncodingId"  parameterType="java.util.Set" resultType="com.edu.erp.model.NameEncodingId">
		select distinct employee_name as name,encoding,id from tab_employee_info where
		status != 0
		and encoding in 
		  <foreach item="item" index="index" collection="employeeEncodings"
		      open="(" separator="," close=")">
		        #{item,jdbcType=VARCHAR}
		  </foreach>	
	</select>
	
	<select id="isEncodingExisted" resultType="int">
		select count(0) from tab_teacher_info where 
		status != 0
		and city_id = #{city_id}
		and encoding = #{teacherEncoding,jdbcType=VARCHAR}
	</select>
	
	<select id="isPhoneExisted"  resultType="int">
		select count(0) from tab_teacher_info where 
		status != 0
		and city_id = #{city_id}
		and phone = #{phone,jdbcType=VARCHAR}
	</select>
	
	<select id="querySubjectOfCity" resultType="com.edu.erp.model.TPSubject">
		select distinct t.name, t.encoding, t.id,bdr.bu_id buId,oi.org_name orgName
		from tp_subject t
		inner join Bu_Dict_Rel bdr
		on bdr.DICT_ID = t.id
		and bdr.DICT_TYPE = 'tp_subject'
		left join tab_organization_info oi
		on bdr.bu_id = oi.id
		WHERE t.STATUS = 1
		and oi.parent_id = #{cityId,jdbcType=NUMERIC}
	</select>
	<select id="queryBuOfCity" resultType="com.edu.erp.model.OrganizationInfo" >
		select oi.* from tab_organization_info oi where oi.parent_id = #{cityId,jdbcType=NUMERIC}
	</select>
</mapper>