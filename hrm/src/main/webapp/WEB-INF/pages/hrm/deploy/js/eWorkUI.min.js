"use strict";angular.module("ngLocale",[],["$provide",function(e){var E={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};e.value("$locale",{DATETIME_FORMATS:{AMPMS:["上午","下午"],DAY:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],ERANAMES:["公元前","公元"],ERAS:["公元前","公元"],FIRSTDAYOFWEEK:6,MONTH:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],SHORTDAY:["周日","周一","周二","周三","周四","周五","周六"],SHORTMONTH:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],STANDALONEMONTH:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],WEEKENDRANGE:[5,6],fullDate:"y年M月d日EEEE",longDate:"y年M月d日",medium:"y年M月d日 ah:mm:ss",mediumDate:"y年M月d日",mediumTime:"ah:mm:ss",short:"y/M/d ah:mm",shortDate:"y/M/d",shortTime:"ah:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"¥",DECIMAL_SEP:".",GROUP_SEP:",",PATTERNS:[{gSize:3,lgSize:3,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,maxFrac:2,minFrac:2,minInt:1,negPre:"-¤",negSuf:"",posPre:"¤",posSuf:""}]},id:"zh",localeID:"zh",pluralCat:function(e,a){return E.OTHER}})}]);
"use strict";angular.module("ework-ui",["ui.bootstrap","ui.router","ngResource"]);
"use strict";angular.module("ework-ui").config(["$stateProvider","$urlRouterProvider",function(e,t){function u(t){if("$state"==t.type&&(a[t.value]||(a[t.value]={value:t.value,url:t.path,templateUrl:t.href},t.value&&e.state(t.value,{url:t.path,templateUrl:t.href}))),t.menus){var r=t.menus;r&&$.each(r,function(e,t){u(t)})}}var a={};$.ajax({url:"common/rightservice",type:"GET",async:!1,dataType:"json",success:function(e,t){u(e),a=null},error:function(){}})}]);
"use strict";!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){var e=function(e,n){var n=n||t(e.imageBox),i={state:{},ratio:1,options:e,imageBox:n,thumbBox:n.find(e.thumbBox),spinner:n.find(e.spinner),image:new Image,getDataURL:function(){var t=this.thumbBox.width(),e=this.thumbBox.height(),i=document.createElement("canvas"),o=n.css("background-position").split(" "),a=n.css("background-size").split(" "),s=parseInt(o[0])-n.width()/2+t/2,r=parseInt(o[1])-n.height()/2+e/2,u=parseInt(a[0]),c=parseInt(a[1]),m=parseInt(this.image.height),p=parseInt(this.image.width);i.width=t,i.height=e;var h=i.getContext("2d");h.drawImage(this.image,0,0,p,m,s,r,u,c);var g=i.toDataURL("image/png");return g},getBlob:function(){for(var t=this.getDataURL(),e=t.replace("data:image/png;base64,",""),n=atob(e),i=[],o=0;o<n.length;o++)i.push(n.charCodeAt(o));return new Blob([new Uint8Array(i)],{type:"image/png"})},zoomIn:function(){this.ratio*=1.1,o()},zoomOut:function(){this.ratio*=.9,o()}},o=function(){var t=parseInt(i.image.width)*i.ratio,e=parseInt(i.image.height)*i.ratio,o=(n.width()-t)/2,a=(n.height()-e)/2;n.css({"background-image":"url("+i.image.src+")","background-size":t+"px "+e+"px","background-position":o+"px "+a+"px","background-repeat":"no-repeat"})},a=function(t){t.preventDefault(),t.stopImmediatePropagation(),i.state.dragable=!0,"touchstart"===t.type?(i.state.mouseX=event.touches[0].clientX,i.state.mouseY=event.touches[0].clientY):(i.state.mouseX=t.clientX,i.state.mouseY=t.clientY)},s=function(t){if(t.preventDefault(),t.stopImmediatePropagation(),i.state.dragable){var e=0,o=0;"touchmove"===t.type?(e=event.touches[0].clientX-i.state.mouseX,o=event.touches[0].clientY-i.state.mouseY):(e=t.clientX-i.state.mouseX,o=t.clientY-i.state.mouseY);var a=n.css("background-position").split(" "),s=e+parseInt(a[0]),r=o+parseInt(a[1]);n.css("background-position",s+"px "+r+"px"),"touchmove"===t.type?(i.state.mouseX=event.touches[0].clientX,i.state.mouseY=event.touches[0].clientY):(i.state.mouseX=t.clientX,i.state.mouseY=t.clientY)}},r=function(t){t.preventDefault(),t.stopImmediatePropagation(),i.state.dragable=!1},u=function(t){t.originalEvent.wheelDelta>0||t.originalEvent.detail<0?i.ratio*=1.1:i.ratio*=.9,o()};return i.spinner.show(),i.image.onload=function(){i.spinner.hide(),o(),n.bind("mousedown",a),n.bind("mousemove",s),t(window).bind("mouseup",r),n.bind("touchstart",a),n.bind("touchmove",s),n.bind("touchend",r),n.bind("mousewheel DOMMouseScroll",u)},i.image.src=e.imgSrc,n.on("remove",function(){t(window).unbind("mouseup",r)}),i};jQuery.fn.cropbox=function(t){return new e(t,this)}});
function LeftNavCtrl(e,n,t,a,u){function o(){var n=t.path();if(a.info("$location path is "+n),n&&(a.log("sub menu path is "+n),e.$parent.curSystem)){var u=s(e.$parent.curSystem.menus,n);u&&(a.log("found menu is "+u.name),e.selectNav(u))}}function s(n,t){if(n&&n.length){var u=null;return $.each(n,function(n,o){t==o.path&&(u=o),u||o.menus&&(u=s(o.menus,t),u&&(a.log("found sub menu,so open parent menu "+o.name),e.selectNav(o)))}),u}return null}e.curNavSystem=null,e.selectNav=function(n){e.curNavSystem&&(e.curNavSystem.active="false"),e.curNavSystem=n,e.curNavSystem.active="true",n.menus&&n.menus.length&&(n.open?n.open=!1:n.open=!0),("$state"==n.type||n.value)&&u.go(n.value,n)},e.isNavDown=!1,e.downNav=function(){e.isNavDown?e.isNavDown=!1:e.isNavDown=!0},e.$watch("$parent.curSystem",function(e,n,t){o()})}angular.module("ework-ui").controller("LeftNavCtrl",["$scope","$rootScope","$location","$log","$state",LeftNavCtrl]);
function TopHeadCtrl(e,t,r,o,a,n,c){function i(){o.get({},function(t){0==t.error&&(e.rootNode=t.data,$("#org_tree").jstree({plugins:["types"],types:{menus:{icon:"fa fa-folder-o"},leaf:{icon:"fa fa-file-text-o"}},core:{data:e.rootNode,check_callback:function(e,t,r,o,a){}}}),$("#org_tree").bind("click.jstree",function(e){var t=(e.target.text,{});t.id=e.target.id.replace("_anchor",""),e.target.id&&""!=e.target.id&&l(t)}),$("#org_tree").bind("dblclick.jstree",function(e){var t=e.target.text;r.log(t);var o={};o.id=e.target.id.replace("_anchor",""),l(o)}),r.log("组织机构加载成功!"))})}function l(e){o.put(e,function(e){location.reload(!0),"false"==e.error})}function d(){a.query({},function(t){t.error||(e.selectedNode=t.data)})}function u(){n.query({},function(t){t.error||(e.systemParam=t.data)})}function f(){c.query({},function(t){t.error||(e.employee=t.data)})}e.selectedNode={},e.rootNode={},e.systemParam={},e.toChangeOrg=function(){i()},i(),d(),u(),f()}angular.module("ework-ui").controller("TopHeadCtrl",["$scope","$state","$log","PUBORGService","PUBORGSelectedService","PUBSystemParamService","PUBEmployeeService",TopHeadCtrl]);
jQuery.extend({createUploadIframe:function(e,t){var r="jUploadFrame"+e,a='<iframe id="'+r+'" name="'+r+'" style="position:absolute; top:-9999px; left:-9999px"';return window.ActiveXObject&&("boolean"==typeof t?a+=' src="javascript:false"':"string"==typeof t&&(a+=' src="'+t+'"')),a+=" />",jQuery(a).appendTo(document.body),jQuery("#"+r).get(0)},createUploadForm:function(e,t,r){var a="jUploadForm"+e,n="jUploadFile"+e,o=jQuery('<form  action="" method="POST" name="'+a+'" id="'+a+'" enctype="multipart/form-data"></form>');if(r)for(var u in r)jQuery('<input type="hidden" name="'+u+'" value="'+r[u]+'" />').appendTo(o);var d=jQuery("#"+t),c=jQuery(d).clone();return jQuery(d).attr("id",n),jQuery(d).before(c),jQuery(d).appendTo(o),jQuery(o).css("position","absolute"),jQuery(o).css("top","-1200px"),jQuery(o).css("left","-1200px"),jQuery(o).appendTo("body"),o},ajaxFileUpload:function(e){e=jQuery.extend({},jQuery.ajaxSettings,e);var t=(new Date).getTime(),r=jQuery.createUploadForm(t,e.fileElementId,"undefined"!=typeof e.data&&e.data),a=(jQuery.createUploadIframe(t,e.secureuri),"jUploadFrame"+t),n="jUploadForm"+t;e.global&&!jQuery.active++&&jQuery.event.trigger("ajaxStart");var o=!1,u={};e.global&&jQuery.event.trigger("ajaxSend",[u,e]);var d=function(t){var n=document.getElementById(a);try{n.contentWindow?(u.responseText=n.contentWindow.document.body?n.contentWindow.document.body.innerHTML:null,u.responseXML=n.contentWindow.document.XMLDocument?n.contentWindow.document.XMLDocument:n.contentWindow.document):n.contentDocument&&(u.responseText=n.contentDocument.document.body?n.contentDocument.document.body.innerHTML:null,u.responseXML=n.contentDocument.document.XMLDocument?n.contentDocument.document.XMLDocument:n.contentDocument.document)}catch(t){jQuery.handleError(e,u,null,t)}if(u||"timeout"==t){o=!0;var d;try{if(d="timeout"!=t?"success":"error","error"!=d){var c=jQuery.uploadHttpData(u,e.dataType);e.success&&e.success(c),e.global&&jQuery.event.trigger("ajaxSuccess",[u,e])}else jQuery.handleError(e,u,d)}catch(t){d="error",jQuery.handleError(e,u,d,t)}e.global&&jQuery.event.trigger("ajaxComplete",[u,e]),e.global&&!--jQuery.active&&jQuery.event.trigger("ajaxStop"),e.complete&&e.complete(u,d),jQuery(n).unbind(),setTimeout(function(){try{jQuery(n).remove(),jQuery(r).remove()}catch(t){jQuery.handleError(e,u,null,t)}},100),u=null}};e.timeout>0&&setTimeout(function(){o||d("timeout")},e.timeout);try{var r=jQuery("#"+n);jQuery(r).attr("action",e.url),jQuery(r).attr("method","POST"),jQuery(r).attr("target",a),r.encoding?jQuery(r).attr("encoding","multipart/form-data"):jQuery(r).attr("enctype","multipart/form-data"),jQuery(r).submit()}catch(t){jQuery.handleError(e,u,null,t)}return jQuery("#"+a).load(d),{abort:function(){}}},uploadHttpData:function(r,type){var data=!type;if(data="xml"==type||data?r.responseXML:r.responseText,"script"==type&&jQuery.globalEval(data),"json"==type){data=r.responseText;var start=data.indexOf(">");if(start!=-1){var end=data.indexOf("<",start+1);end!=-1&&(data=data.substring(start+1,end))}eval("data = "+data)}return"html"==type&&jQuery("<div>").html(data).evalScripts(),data},handleError:function(e,t,r,a){e.error&&e.error.call(e.context||e,t,r,a),e.global&&(e.context?jQuery(e.context):jQuery.event).trigger("ajaxError",[t,e,a])}});
angular.module("ework-ui").controller("DatepickerDemoCtrl",["$scope","$log",function(e,t){e.today=function(){e.dt=new Date},e.clear=function(){e.dt=null},e.disabled=function(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())},e.toggleMin=function(){e.minDate=e.minDate?null:new Date},e.toggleMin(),e.open=function(t){t.preventDefault(),t.stopPropagation(),e.opened=!0},e.dateOptions={formatYear:"yy",startingDay:1,class:"datepicker"},e.initDate=new Date,e.formats=["yyyy-MM-dd","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0]}]),angular.module("ework-ui").directive("datetimepickerNeutralTimezone",function(){return{restrict:"A",priority:1,require:"ngModel",link:function(e,t,n,r){r.$formatters.push(function(e){var t=new Date(Date.parse(e));return t=new Date(t.getTime()+6e4*t.getTimezoneOffset())}),r.$parsers.push(function(e){var t=new Date(e.getTime()-6e4*e.getTimezoneOffset());return t})}}});
function MasterCtrl(e,t,n,a,u,r){function c(){u.get({},function(t){"false"==t.error&&(e.project=t,$("title").text(e.project.name))})}function s(){var u=t.path();if(n.info("$location path is "+u),u){var r=u.split("/");if(n.log(r.join(",")),r.length<2||!r[1])return;var c="/"+r[1];n.log("sub menu path is "+c);var s=o(e.topMenus,c);s&&(n.log("found menu is "+s.name),e.curSystem&&(e.curSystem.active="false"),e.curSystem=s,e.curSystem.active="true")}else a.go("index",{})}function o(e,t){if(e&&e.length){var n=null;return $.each(e,function(e,a){t==a.path&&(n=a),n}),n}return null}e.topMenus={},r&&(n.info("found service MenusService."),r.get({},function(t){n.info("found service result."),e.topMenus=t.menus,n.info("found service result."+t),$.each(e.topMenus,function(t,a){"true"==a.active&&(e.curSystem=a,n.info("menu active is "+a.name))}),s()})),e.selectSystem=function(t){e.curSystem&&(e.curSystem.active="false"),e.curSystem=t,e.curSystem.active="true","$state"==t.type&&a.go(t.value,{})},c(),e.getNumber=function(e){for(var t=new Array,n=0;n<e;n++)t.push(n+1);return t},e.checked=function(e){e.checked?e.checked=!1:e.checked=!0},e.userMenus={index:"C10001",name:"个人管理",key:"userManagerment",icon:"fa fa-diamond",type:"$state",value:"userManagerment",path:"/userManagerment",showMenu:"false",menus:[{index:"C10001",name:"账户安全",key:"UMAccountMgr",icon:"fa fa-video-camera",type:"$state",value:"UMAccountMgr",path:"/userManagerment/UMAccountMgr",href:"templates/segment/account_security.html"},{index:"C10002",name:"个人信息",key:"UMEmployeeInfo",icon:"fa fa-video-camera",type:"$state",value:"UMEmployeeInfo",path:"/userManagerment/UMEmployeeInfo",href:"templates/segment/employee_info.html"}]},e.selectUserNav=function(t){e.curNavSystem&&(e.curNavSystem.active="false"),e.curNavSystem=t,e.curNavSystem.active="true",t.menus&&t.menus.length&&(t.open?t.open=!1:t.open=!0),("$state"==t.type||t.value)&&(e.curSystem&&(e.curSystem.active="false",e.curSystem=e.userMenus,e.curSystem.active="true"),a.go(t.value,t))}}angular.module("ework-ui").controller("MasterCtrl",["$scope","$location","$log","$state","ProjectService","MenusService",MasterCtrl]);
function PaginationDemoCtrl(e,t){function a(){1==e.loaded&&(e.data=e.$parent.datas,e.totalItems=e.data.length,e.child.currentPage=e.currentPage,e.child.itemsPerPage=e.itemsPerPage)}e.$parent.$watch("loaded",function(e){a()}),e.viewby=5,e.currentPage=4,e.itemsPerPage=e.viewby,e.maxSize=50,e.setPage=function(t){e.currentPage=t},e.pageChanged=function(){e.$parent.datas&&(e.child.currentPage=e.currentPage),e.child.itemsPerPage=e.itemsPerPage},e.selectPage=function(){e.child.itemsPerPage=e.itemsPerPage},e.setItemsPerPage=function(t){e.itemsPerPage=t,e.currentPage=1}}angular.module("ework-ui").controller("PaginationDemoCtrl",["$scope","$log",PaginationDemoCtrl]);
angular.module("ework-ui").controller("TooltipDemoCtrl",function(t,o){t.dynamicTooltip="此字段不能为空!",t.dynamicTooltipText="dynamic",t.htmlTooltip=o.trustAsHtml("I've been made <b>bold</b>!"),t.placement={options:["top","top-left","top-right","bottom","bottom-left","bottom-right","left","left-top","left-bottom","right","right-top","right-bottom"],selected:"top"}});
"use strict";function HelloService(e){return e("data/helloworld.json",{},{query:{method:"GET",params:{},isArray:!1}})}angular.module("ework-ui").factory("HelloService",["$resource",HelloService]);
function AccountCtrl(e,c,o,n,t,r,a,u){function l(c){var o={};o.accountId=c.id,a.delete(o,function(c){"false"==c.error?(alert("禁用成功！"),e.queryAccount()):alert("删除失败："+c.message+",请截图反馈给ERP客服！")})}function i(e){var c=e;return c.selectedBranch=h(),c.selectedBranch&&0!=c.selectedBranch.length?void a.update(c,function(e){"false"==e.error?alert("修改成功！"):alert("修改失败："+e.message+",请截图反馈给ERP客服！")}):void alert("未选择任何的账户校区!")}function d(c){var o=c;e.curAccount.selectedCompany&&(o.companyId=e.curAccount.selectedCompany.id),a.add(o,function(o){"false"==o.error?(alert("添加成功！"),e.accountList.push(c)):alert("添加失败："+o.message+",请截图反馈给ERP客服！")})}function s(c){var o={};o.accountId=c.id,e.isLoadingRole="loading...",n.queryRoleWithAccount(o,function(o){e.isLoadingRole="","false"==o.error&&(c.roleList=o.data)})}function f(){var c={};e.isLoadingRoleList="loading...",e.rolePage.roleCompany&&(c.p_selectedCompany=e.rolePage.roleCompany),e.rolePage.roleBranch&&(c.p_selectedBranch=e.rolePage.roleBranch),c.p_searchInfo=e.rolePage.roleSearchInfo,c.p_accountId=e.curAccount.id,n.get(c,function(c){if(e.isLoadingRoleList="","false"==c.error){var o=[];$.each(c.data,function(c,n){var t=!1;$.each(e.curAccount.roleList,function(e,c){n.id==c.id&&(t=!0)}),t||o.push(n)}),e.roleList=o}})}function p(e){$("#branchTree").jstree("destroy").empty();var c={};c.accountId=e.id,u.queryTree(c,function(c){e.branchTree=c.data,$("#branchTree").jstree({plugins:["types","checkbox"],types:{menus:{icon:"fa fa-folder-o"},leaf:{icon:"fa fa-file-text-o"}},core:{data:e.branchTree,check_callback:function(e,c,o,n,t){}}})})}function h(){var e=$("#branchTree").jstree(!0),c=e.get_selected(!0),o=[];for(var n in c){var t=c[n].type;"leaf"==t&&o.push(c[n].id)}return o}function A(){t.get({},function(c){"false"==c.error&&(e.companyList=c.data)})}function g(){r.get({},function(c){"false"==c.error&&(e.branchsList=c.data)})}e.currentPage=1,e.totalPage=1,e.pageSize=50,e.accountList=[],e.companyList=[],e.branchsList=[],e.operateType="",e.curAccountRole={},e.role_search_info="",e.rolePage={roleCompany:null,roleBranch:null,roleSearchInfo:""},e.queryAccount=function(){var o={};e.selectedCompany&&(o.p_selectedCompany=e.selectedCompany.id),e.branch&&(o.p_selectedBranch=e.branch.id),c.log("selectedBranch="+o.p_selectedBranch),e.search_info&&(o.p_searchInfo=e.search_info),o.pageSize=e.pageSize,o.currentPage=e.currentPage,o.totalPage=e.totalPage,e.isLoading="loading...",e.curAccount=null,a.get(o,function(c){e.isLoading="","false"==c.error&&(e.accountList=c.data,e.currentPage=c.currentPage,e.totalPage=c.totalPage,e.pageSize=c.pageSize)})},e.toAddAccountPanel=function(){e.operateType="addAccount",e.curAccount={},$("#accountMgrPanel").modal("show")},e.toUpdateAccountPanel=function(c){e.curAccount=c,e.operateType="updateAccount",$("#accountMgrPanel").modal("show")},e.toDeleteAccountPanel=function(c){e.curAccount=c,e.operateType="deleteAccount",e.comfirmAccount()},e.toAddRolePanel=function(){return e.curAccount?(e.curAccountRole={},$("#accountMgrRolePanel").modal("show"),void f()):void alert("请选择账户！")},e.queryAllRole=function(){f()},e.comfirmAccount=function(){"addAccount"==e.operateType?d(e.curAccount):"updateAccount"==e.operateType?i(e.curAccount):"deleteAccount"==e.operateType&&l(e.curAccount)},e.removeRole=function(c){if(!e.curAccount)return void alert("请选择账户！");if(e.curAccount.roleList){var o=[];$.each(e.curAccount.roleList,function(e,n){n.id!=c.id&&o.push(n)}),e.curAccount.roleList=o}},e.checked=function(c){e.curAccount&&e.curAccount.hasOwnProperty("checked")&&(e.curAccount.checked=!1),c.checked?c.checked=!1:(c.checked=!0,e.curAccount=c,s(c),p(c))},e.selectedRole=function(c){e.curAccount||alert("请选择账户！"),e.curAccount.roleList||(e.curAccount.roleList=[]),e.curAccount.roleList.push(c),f()},e.updateAccount=function(){return e.curAccount?void i(e.curAccount):void alert("请选择账户！")},e.queryBranchsWithId=function(c){var o={};c.id?o.companyId=c.id:o.companyId=c,r.get(o,function(c){"false"!=c.error&&0!=c.error||(e.branchsList=c.data)})},e.queryAccount(),A(),g()}angular.module("ework-ui").controller("AccountCtrl",["$scope","$log","$state","RoleService","CompanyService","BranchsService","AccountService","BranchTreeService",AccountCtrl]);
function AccountSecurityCtrl(n,t,r,c,o){function e(){c.query({},function(r){t.log(r.data),n.currentAccount=r.data})}function u(){var t=n.nextJudgePassword;if("true"==t){var r=n.newAccountPassword;if(null!=r&&""!=r){var c=n.confirmPassword;r==c?(n.currentAccount.password=r,s()):alert("请输入相同的密码")}else alert("请输入新的密码")}else alert("当前登录密码输入错误")}function a(){var r={};r.nowPassword=n.nowPassword,o.get(r,function(r){t.log(r.data),n.nextJudgePassword=r.data,"false"!=n.nextJudgePassword&&u()})}function s(){t.log("new password is:"+n.currentAccount.password),c.put(n.currentAccount,function(n){alert("修改成功！")}),function(n){alert("修改失败："+resp.message+",请截图反馈给ERP客服！")}}n.currentAccount=null,n.nextJudgePassword=null,n.nowPassword=null,n.clickUpdateCurrentAccount=function(){a()},e()}angular.module("ework-ui").controller("AccountSecurityCtrl",["$scope","$log","$state","PUBAccountService","JudgePasswordService",AccountSecurityCtrl]);
function EmployeeInfoCtrl(e,l,o,n){function r(){n.query({},function(o){l.log(o.data),e.currentEmployee=o.data})}function t(){n.put(e.currentEmployee,function(e){"false"==e.error||0==e.error?alert("修改成功！"):alert("修改失败："+e.message+",请截图反馈给ERP客服！")})}e.currentEmployee=null,e.all=!0,e.readonly="编辑",e.updateReadonly=function(){e.all?(e.all=!1,e.readonly="返回"):(e.all=!0,e.readonly="编辑")},e.updateCurrentEmployee=function(){t()},r()}angular.module("ework-ui").controller("EmployeeInfoCtrl",["$scope","$log","$state","PUBEmployeeService",EmployeeInfoCtrl]);
function RoleCtrl(e,a,t,n,r,o,l){function c(){var a=y();e.selectedRole.selectedPrivileges=a,e.selectedRole.companyId&&(e.selectedRole.companyId=e.selectedRole.companyId.id),e.selectedRole.branchId&&(e.selectedRole.branchId=e.selectedRole.branchId),n.add(e.selectedRole,function(a){"false"==a.error&&(alert("添加成功!"),e.queryIndex(e.currentPage))})}function i(){var a={};a.roleId=e.selectedRole.id,n.delete(a,function(a){"false"==a.error&&(alert("禁用成功!"),e.queryIndex(e.currentPage))})}function s(){var a=y();e.selectedRole.selectedPrivileges=a,e.selectedRole.companyId&&(e.selectedRole.companyId=e.selectedRole.companyId),e.selectedRole.branchId&&(e.selectedRole.branchId=e.selectedRole.branchId),n.update(e.selectedRole,function(e){"false"==e.error&&alert("修改成功!")})}function d(){var a={};e.selectedCompany&&(a.p_selectedCompany=e.selectedCompany.id),e.selectedBranch&&(a.p_selectedBranch=e.selectedBranch.id),e.search_info&&(a.p_searchInfo=e.search_info),a.pageSize=e.pageSize,a.currentPage=e.currentPage,a.totalPage=e.totalPage,e.isLoading="loading...",e.roleList=[],n.get(a,function(a){e.isLoading="","false"==a.error&&(e.roleList=a.data,e.currentPage=a.currentPage,e.totalPage=a.totalPage,e.pageSize=a.pageSize,h())})}function u(){r.get({},function(a){"false"!=a.error&&0!=a.error||(e.companyList=a.data)})}function p(){o.get({},function(a){"false"==a.error&&(e.branchs=a.data)})}function g(e,a,t,n){$("#treeRole").jstree("destroy").empty(),a&&a.length&&$.each(a,function(a,r){if("line"!=r.type){var o=r.index;r.selected=!1;for(var a in n)if(n[a]==o){r.selected=!0;break}var l={text:r.name,id:o,parent_id:t.id,type:r.menus&&r.menus.length?"menus":"leaf",state:{selected:r.selected}};if(e.push(l),r.menus&&r.menus.length){var c=[];l.children=c,g(l.children,r.menus,l,n)}}})}function f(a){l.get({},function(t){var n=t.menus;e.allMenus=n;var r=[],o={id:"root"};g(r,n,o,a),$("#treeRole").jstree({plugins:["types","checkbox"],types:{menus:{icon:"fa fa-folder-o"},leaf:{icon:"fa fa-file-text-o"}},core:{data:r,check_callback:function(e,a,t,n,r){}}})})}function y(){var e=$("#treeRole").jstree(!0),t=e.get_selected(!0),n=[];for(var r in t){var o=t[r].type;"leaf"==o&&n.push(t[r].id)}return a.log(n.join(",")),n}function h(){var a=new Array;if(e.currentPage==e.totalPage){for(var t=e.totalPage-9,n=t<0?1:t,r=n;r<=e.totalPage;r++)a.push(r);e.paginationBars=a}else if(1==e.currentPage)e.initNumber(e.totalPage);else{var o=e.paginationBars.length,l=e.paginationBars[o-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(o,1)):e.currentPage>l&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(o-1,0,l+1))}}e.roleList=[],e.companyList=[],e.branchs=[],e.privileges=[],e.operateType="",e.currentPage=1,e.totalPage=1,e.pageSize=20,e.paginationBars=[],e.toAddRolePanel=function(){e.operateType="add",e.selectedRole={},f(null),$("#roleMgrPanel").modal("show")},e.toUpdateRolePanel=function(a){$("#roleMgrPanel").modal("show"),e.selectedRole=a,e.operateType="update",f(a.privileges),$("#roleMgrPanel").modal("show")},e.toForbiddenRolePanel=function(a){e.operateType="forbidden",e.selectedRole=a,e.saveRole()},e.saveRole=function(){"add"==e.operateType?c():"update"==e.operateType?s():"forbidden"==e.operateType&&i()},e.queryRole=function(){d()},e.queryBranchsWithId=function(a){var t={};a.id?t.companyId=a.id:t.companyId=a,o.get(t,function(a){"false"!=a.error&&0!=a.error||(e.branchs=a.data)})},e.selectedNode=[],e.allMenus=[],e.initNumber=function(a){for(var t=new Array,n=1;n<=10&&n<=a;n++)t.push(n);e.paginationBars=t},e.queryIndex=function(a){(a<=0||a>e.totalPage)&&e.totalPage>0||(e.currentPage=a,d())},d(),u(),p()}angular.module("ework-ui").controller("RoleCtrl",["$scope","$log","$state","RoleService","CompanyService","BranchsService","MenusService",RoleCtrl]);
function AccomplishmentDetailCtrl(e,a,t,r,n,i){function o(){var a=new Array;if(e.currentPage==e.totalPage){for(var t=e.totalPage-9,r=t<0?1:t,n=r;n<=e.totalPage;n++)a.push(n);e.paginationBars=a}else if(1==e.currentPage)e.initNumber(e.totalPage);else{var i=e.paginationBars.length,o=e.paginationBars[i-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(i,1)):e.currentPage>o&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(i-1,0,o+1))}}function c(){n.get({},function(a){"false"==a.error&&(a.data.unshift({id:"-1",name:"全部"}),e.branchsList=a.data,e.selectedBranch=e.branchsList[0])})}function l(){r.get({},function(a){"false"==a.error&&(a.data.unshift({id:"-1",name:"全部"}),e.companys=a.data,e.selectedCompany=e.companys[0])})}function s(){if(!e.selectedCompany)return void alert("请选择公司！");if(!e.selectedBranch)return void alert("请选择校区！");if(!e.st)return void alert("开始时间必须录入！");if(!e.dt)return void alert("截止时间必须录入！");var t={};t.rows=9,t.pageSize=e.pageSize,t.currentPage=e.currentPage,t.totalPage=e.totalPage,t.search_info=e.search_info,t.companyId=e.selectedCompany.id,t.branchId=e.selectedBranch.id,t.calcBeginDate=$("#beginDate").val(),t.calcEndDate=$("#endDate").val(),t.isWfd=$("#isWfd").prop("checked"),t.reportType="queryAccomplishmentDetais",e.isLoadingOrders="loading...",e.reportData=[],i.query(t,function(t){"false"==t.error&&(e.reportData=t.data,u(e.reportData),e.currentPage=t.currentPage,e.totalPage=t.totalPage,e.pageSize=t.pageSize,o(),a.log("pageSize is"+e.pageSize+",totalPage is "+e.totalPage+",currentPage"+e.currentPage)),e.isLoadingOrders=""},function(a){alert("异常:"+a.data.message+"请联系管理员！"),e.isLoadingOrders=""})}function u(e){var a=0,t=null,r=null,n=null,i=0;$.each(e,function(o,c){c.first=!1,isEmpty(t)&&(t=c.optEncoding,r=c,c.first=!0,i=o),n=c.optEncoding,t!=n||t==n&&6==c.optType&&0==c.feeAmount&&c.courseBranchName!=r.courseBranchName||a++,(t!=n||t==n&&6==c.optType&&0==c.feeAmount&&c.courseBranchName!=r.courseBranchName)&&(t=n,r=c,e[i].countSub=a,i=o,c.first=!0,a=1)}),a>1&&(e[i].countSub=a)}e.companys=[],e.reportData=[],e.st=new Date,e.dt=new Date,e.search_info="",e.queryInfo=function(){e.currentPage=1,s()},e.getNumber=function(e){for(var a=new Array,t=0;t<e;t++)a.push(t+1);return a},e.initNumber=function(a){for(var t=new Array,r=1;r<=10&&r<=a;r++)t.push(r);e.paginationBars=t},e.queryIndex=function(a){(a<=0||a>e.totalPage)&&e.totalPage>0||(e.currentPage=a,e.queryInfo())},e.exp=function(){if(!e.selectedCompany)return void alert("请选择公司！");if(!e.selectedBranch)return void alert("请选择校区！");if(!e.st)return void alert("开始时间必须录入！");if(!e.dt)return void alert("截止时间必须录入！");if(confirm("确定要导出?")){var a="?companyId="+e.selectedCompany.id+"&branchId="+e.selectedBranch.id+"&isWfd="+$("#isWfd").prop("checked")+"&calcBeginDate="+$("#beginDate").val()+"&calcEndDate="+$("#endDate").val();window.open("excels/output/outExcelAccomplishmentdetail"+a,"_blank")}},l(),c()}angular.module("ework-ui").directive("block",["$compile",function(e){return{restrict:"E",template:"",transclude:!0}}]).controller("AccomplishmentDetailCtrl",["$scope","$log","$state","CompanyService","BranchsService","ReportService",AccomplishmentDetailCtrl]);
function AccountBalanceCtrl(a,e,t,n,r,i){function o(){var e=new Array;if(a.currentPage==a.totalPage){for(var t=a.totalPage-9,n=t<0?1:t,r=n;r<=a.totalPage;r++)e.push(r);a.paginationBars=e}else if(1==a.currentPage)a.initNumber(a.totalPage);else{var i=a.paginationBars.length,o=a.paginationBars[i-1];a.currentPage<a.paginationBars[0]?(a.paginationBars.splice(0,0,a.paginationBars[0]-1),a.paginationBars.splice(i,1)):a.currentPage>o&&a.currentPage<a.totalPage&&(a.paginationBars.splice(0,1),a.paginationBars.splice(i-1,0,o+1))}}function c(){r.get({},function(e){"false"==e.error&&(e.data.unshift({id:"-1",name:"全部"}),a.branchsList=e.data,a.selectedBranch=a.branchsList[0])})}function s(){n.get({},function(e){"false"==e.error&&(e.data.unshift({id:"-1",name:"全部"}),a.companys=e.data,a.selectedCompany=a.companys[0])})}function u(){var t={};t.rows=9,t.pageSize=a.pageSize,t.currentPage=a.currentPage,t.totalPage=a.totalPage,t.companyId=a.selectedCompany.id,t.branchId=a.selectedBranch.id,t.reportType="queryAccountBalance",a.isLoadingOrders="loading...",a.reportData=[],i.query(t,function(t){a.reportData=t.data,a.currentPage=t.currentPage,a.totalPage=t.totalPage,a.pageSize=t.pageSize,o(),e.log("pageSize is"+a.pageSize+",totalPage is "+a.totalPage+",currentPage"+a.currentPage),a.isLoadingOrders=""},function(e){alert("异常:"+e.data.message+"请联系管理员！"),a.isLoadingOrders=""})}a.companys=[],a.reportData=[],a.search_info="",a.queryInfo=function(){a.currentPage=1,u()},a.getNumber=function(a){for(var e=new Array,t=0;t<a;t++)e.push(t+1);return e},a.initNumber=function(e){for(var t=new Array,n=1;n<=10&&n<=e;n++)t.push(n);a.paginationBars=t},a.queryIndex=function(e){(e<=0||e>a.totalPage)&&a.totalPage>0||(a.currentPage=e,u())},a.exp=function(){if(!a.selectedCompany)return void alert("请选择公司！");if(!a.selectedBranch)return void alert("请选择校区！");if(confirm("确定要导出?")){var e="?companyId="+a.selectedCompany.id+"&branchId="+a.selectedBranch.id;window.open("excels/output/outExcelAccountbalance"+e,"_blank")}},s(),c()}angular.module("ework-ui").directive("block",["$compile",function(a){return{restrict:"E",template:"",transclude:!0}}]).controller("AccountBalanceCtrl",["$scope","$log","$state","CompanyService","BranchsService","ReportService",AccountBalanceCtrl]);
function AccountDayBooksCtrl(a,e,t,n,r,i){function o(){var e=new Array;if(a.currentPage==a.totalPage){for(var t=a.totalPage-9,n=t<0?1:t,r=n;r<=a.totalPage;r++)e.push(r);a.paginationBars=e}else if(1==a.currentPage)a.initNumber(a.totalPage);else{var i=a.paginationBars.length,o=a.paginationBars[i-1];a.currentPage<a.paginationBars[0]?(a.paginationBars.splice(0,0,a.paginationBars[0]-1),a.paginationBars.splice(i,1)):a.currentPage>o&&a.currentPage<a.totalPage&&(a.paginationBars.splice(0,1),a.paginationBars.splice(i-1,0,o+1))}}function o(){var e=new Array;if(a.currentPage==a.totalPage){for(var t=a.totalPage-9,n=t<0?1:t,r=n;r<=a.totalPage;r++)e.push(r);a.paginationBars=e}else if(1==a.currentPage)a.initNumber(a.totalPage);else{var i=a.paginationBars.length,o=a.paginationBars[i-1];a.currentPage<a.paginationBars[0]?(a.paginationBars.splice(0,0,a.paginationBars[0]-1),a.paginationBars.splice(i,1)):a.currentPage>o&&a.currentPage<a.totalPage&&(a.paginationBars.splice(0,1),a.paginationBars.splice(i-1,0,o+1))}}function c(){r.get({},function(e){"false"==e.error&&(e.data.unshift({id:"-1",name:"全部"}),a.branchsList=e.data,a.selectedBranch=a.branchsList[0])})}function s(){n.get({},function(e){"false"==e.error&&(e.data.unshift({id:"-1",name:"全部"}),a.companys=e.data,a.selectedCompany=a.companys[0])})}function g(){if(!a.selectedCompany)return void alert("请选择公司！");if(!a.selectedBranch)return void alert("请选择校区！");if(!a.st)return void alert("开始时间必须录入！");if(!a.dt)return void alert("截止时间必须录入！");var t={};t.rows=8,t.pageSize=a.pageSize,t.currentPage=a.currentPage,t.totalPage=a.totalPage,t.search_info=a.search_info,t.companyId=a.selectedCompany.id,t.branchId=a.selectedBranch.id,t.student=a.student,t.calcBeginDate=$("#beginDate").val(),t.calcEndDate=$("#endDate").val(),t.reportType="queryAccountDaybooks",a.isLoadingOrders="loading...",a.reportData=[],i.query(t,function(t){a.reportData=t.data,a.currentPage=t.currentPage,a.totalPage=t.totalPage,a.pageSize=t.pageSize,o(),e.log("pageSize is"+a.pageSize+",totalPage is "+a.totalPage+",currentPage"+a.currentPage),a.isLoadingOrders=""},function(e){alert("异常:"+e.data.message+"请联系管理员！"),a.isLoadingOrders=""})}a.companys=[],a.reportData=[],a.st=new Date,a.dt=new Date,a.search_info="",a.queryInfo=function(){a.currentPage=1,g()},a.getNumber=function(a){for(var e=new Array,t=0;t<a;t++)e.push(t+1);return e},a.initNumber=function(e){for(var t=new Array,n=1;n<=10&&n<=e;n++)t.push(n);a.paginationBars=t},a.queryIndex=function(e){(e<=0||e>a.totalPage)&&a.totalPage>0||(a.currentPage=e,g())},a.initNumber=function(e){for(var t=new Array,n=1;n<=10&&n<=e;n++)t.push(n);a.paginationBars=t},a.queryIndex=function(e){(e<=0||e>a.totalPage)&&a.totalPage>0||(a.currentPage=e,g())},a.exp=function(){if(!a.selectedCompany)return void alert("请选择公司！");if(!a.selectedBranch)return void alert("请选择校区！");if(!a.st)return void alert("开始时间必须录入！");if(!a.dt)return void alert("截止时间必须录入！");if(confirm("确定要导出?")){var e="?companyId="+a.selectedCompany.id+"&branchId="+a.selectedBranch.id+"&student="+a.student+"&calcBeginDate="+$("#beginDate").val()+"&calcEndDate="+$("#endDate").val();window.open("excels/output/outExcelAccountdaybooks"+e,"_blank")}},s(),c()}angular.module("ework-ui").directive("block",["$compile",function(a){return{restrict:"E",template:"",transclude:!0}}]).controller("AccountDayBooksCtrl",["$scope","$log","$state","CompanyService","BranchsService","ReportService",AccountDayBooksCtrl]);
function TeacherAttendanceCtrl(e,t,n,a){function c(){a.get({},function(t){"false"==t.error&&(e.teacherAttendanceList=t.data)})}e.teacherAttendanceList=[],c()}angular.module("ework-ui").controller("TeacherAttendanceCtrl",["$scope","$log","$state","TeacherAttendanceService",TeacherAttendanceCtrl]);
function AttendanceConsumeCtrl(e,a,t,n,r,i){function o(){var a=new Array;if(e.currentPage==e.totalPage){for(var t=e.totalPage-9,n=t<0?1:t,r=n;r<=e.totalPage;r++)a.push(r);e.paginationBars=a}else if(1==e.currentPage)e.initNumber(e.totalPage);else{var i=e.paginationBars.length,o=e.paginationBars[i-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(i,1)):e.currentPage>o&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(i-1,0,o+1))}}function c(){r.get({},function(a){"false"==a.error&&(a.data.unshift({id:"-1",name:"全部"}),e.branchsList=a.data,e.selectedBranch=e.branchsList[0])})}function s(){n.get({},function(a){"false"==a.error&&(a.data.unshift({id:"-1",name:"全部"}),e.companys=a.data,e.selectedCompany=e.companys[0])})}function d(){if(!e.selectedCompany)return void alert("请选择公司！");if(!e.selectedBranch)return void alert("请选择校区！");if(!e.st)return void alert("开始时间必须录入！");if(!e.dt)return void alert("截止时间必须录入！");var t={};t.rows=9,t.pageSize=e.pageSize,t.currentPage=e.currentPage,t.totalPage=e.totalPage,t.reportType="queryAttendanceConsume",t.search_info=e.search_info,t.companyId=e.selectedCompany.id,t.branchId=e.selectedBranch.id,t.calcBeginDate=$("#beginDate").val(),t.calcEndDate=$("#endDate").val(),t.isWfd=$("#isWfd").prop("checked"),t.isCourseTime=$("#isCourseTime").prop("checked"),e.isLoadingOrders="loading...",e.reportData=[],i.get(t,function(t){e.reportData=t.data,e.currentPage=t.currentPage,e.totalPage=t.totalPage,e.pageSize=t.pageSize,o(),a.log("pageSize is"+e.pageSize+",totalPage is "+e.totalPage+",currentPage"+e.currentPage),e.isLoadingOrders=""},function(a){alert("异常:"+a.data.message+"请联系管理员！"),e.isLoadingOrders=""})}e.companys=[],e.reportData=[],e.st=new Date,e.dt=new Date,e.search_info="",e.queryInfo=function(){e.currentPage=1,d()},e.getNumber=function(e){for(var a=new Array,t=0;t<e;t++)a.push(t+1);return a},e.initNumber=function(a){for(var t=new Array,n=1;n<=10&&n<=a;n++)t.push(n);e.paginationBars=t},e.queryIndex=function(a){(a<=0||a>e.totalPage)&&e.totalPage>0||(e.currentPage=a,d())},e.exp=function(){if(!e.selectedCompany)return void alert("请选择公司！");if(!e.selectedBranch)return void alert("请选择校区！");if(!e.st)return void alert("开始时间必须录入！");if(!e.dt)return void alert("截止时间必须录入！");if(confirm("确定要导出?")){var a="?companyId="+e.selectedCompany.id+"&branchId="+e.selectedBranch.id+"&isWfd="+$("#isWfd").prop("checked");NaN+$("#isCourseTime").prop("checked")+"&calcBeginDate="+$("#beginDate").val()+"&calcEndDate="+$("#endDate").val(),window.open("excels/output/outExcelAttendanceconsume"+a,"_blank")}},s(),c()}angular.module("ework-ui").directive("block",["$compile",function(e){return{restrict:"E",template:"",transclude:!0}}]).controller("AttendanceConsumeCtrl",["$scope","$log","$state","CompanyService","BranchsService","ReportService",AttendanceConsumeCtrl]);
function AuditLogCtrl(t,e,a,g){function o(){e.log("begin to query logs.pageSize is "+t.pageSize+",currentPage is "+t.currentPage+",totalPage is "+t.totalPage+",beginDate is "+$("#beginDate").val()+",endDate is "+$("#endDate").val()+",search_info is "+t.search_info);var a={};t.auditLogList=[],a.pageSize=t.pageSize,a.currentPage=t.currentPage,a.totalPage=t.totalPage,t.isLoading="loading...",g.get(a,function(a){"false"==a.error&&(t.auditLogList=a.data,t.currentPage=a.currentPage,t.totalPage=a.totalPage,t.pageSize=a.pageSize,a.data&&a.data.length?e.log("found data length is "+a.data.length):e.log("request return ,but data length is 0")),t.isLoading=""})}t.auditLogList=[],t.downUpState=!0,t.downUp=function(){t.downUpState?t.downUpState=!1:t.downUpState=!0},t.queryLog=function(){o()},o(),t.getNumber=function(t){for(var e=new Array,a=0;a<t;a++)e.push(a+1);return e}}angular.module("ework-ui").controller("AuditLogCtrl",["$scope","$log","$state","AuditLogService",AuditLogCtrl]);
function BSAccountMgrCtrl(t,e,n,a,u,r,d,c,s,o,i,l,f){function p(){return++I}function m(){var e={};e.rows=6,e.pageSize=t.pageSize,e.currentPage=t.currentPage,e.totalPage=t.totalPage,e.searchInfo=t.searchInfo,t.selectedCompany&&(e.companyId=t.selectedCompany.id),t.selectedBranch&&(e.schoolId=t.selectedBranch.id),t.isLoadingOrders="loading...",t.accountChangeList=[],d.query(e,function(e){t.isLoadingOrders="",t.accountChangeList=e.data,t.currentPage=e.currentPage,t.totalPage=e.totalPage,t.pageSize=e.pageSize,P()},function(t){alert("查询账户异常,请联系管理员！异常信息："+t.data.message)})}function y(){o.query({},function(e){"false"==e.error&&(t.posList=e.data)})}function A(){i.query({},function(e){"false"==e.error&&(t.accountList=e.data)})}function g(){r.query({},function(e){"false"==e.error&&(t.productList=e.data)})}function h(){a.get({},function(e){"false"==e.error&&(e.data.unshift({id:"-1",name:"全部"}),t.branchsList=e.data,t.selectedBranch=t.branchsList[0])})}function S(){u.get({},function(e){"false"==e.error&&(e.data.unshift({id:"-1",name:"全部"}),t.companys=e.data,t.selectedCompany=t.companys[0])})}function P(){var e=new Array;if(t.currentPage==t.totalPage){for(var n=t.totalPage-9,a=n<0?1:n,u=a;u<=t.totalPage;u++)e.push(u);t.paginationBars=e}else if(1==t.currentPage)t.initNumber(t.totalPage);else{var r=t.paginationBars.length,d=t.paginationBars[r-1];t.currentPage<t.paginationBars[0]?(t.paginationBars.splice(0,0,t.paginationBars[0]-1),t.paginationBars.splice(r,1)):t.currentPage>d&&t.currentPage<t.totalPage&&(t.paginationBars.splice(0,1),t.paginationBars.splice(r-1,0,d+1))}}t.pay={total:0};var I=0;t.addPay=function(e){if("cash"==e){t.pay.type="cash";var n={};n.type="1",n.value=t.pay.value,n.remark=t.pay.remark,n.typeName="现金",n.studentId=t.curStudent.id,n.student_encoding=t.curStudent.studentEncoding,n.student_name=t.curStudent.studentName,n.id=p(),t.pay.payList||(t.pay.payList=[]),t.pay.payList.push(n),t.pay.total=0,$.each(t.pay.payList,function(e,n){t.pay.total+=parseInt(n.value)})}else if("card"==e){var n={};n.type="2",n.id=p(),n.typeName="刷卡",n.value=t.pay.value,n.remark=t.pay.remark,n.companyAccount=t.pay.companyAccount,n.companyCard=t.pay.companyCard,n.card=t.pay.card,n.posName=t.pay.posName,n.posId=t.pay.posId,n.remark=t.pay.remark,n.studentId=t.curStudent.id,n.student_encoding=t.curStudent.studentEncoding,n.student_name=t.curStudent.studentName,t.pay.payList||(t.pay.payList=[]),t.pay.payList.push(n),t.pay.total=0,$.each(t.pay.payList,function(e,n){t.pay.total+=parseInt(n.value)})}else if("transfer"==e){var n={};n.type="3",n.id=p(),n.typeName="transfer",n.value=t.pay.value,n.remark=t.pay.remark,n.card=t.pay.card,n.companyAccount=t.pay.companyAccount,n.companyCard=t.pay.companyCard,n.remark=t.pay.remark,n.studentId=t.curStudent.id,n.student_encoding=t.curStudent.studentEncoding,n.student_name=t.curStudent.studentName,t.pay.payList||(t.pay.payList=[]),t.pay.payList.push(n),t.pay.total=0,$.each(t.pay.payList,function(e,n){t.pay.total+=parseInt(n.value)})}},t.removePay=function(e,n){var a=[];$.each(t.pay.payList,function(t,e){e.id!=n.id&&a.push(e)}),t.pay.payList=a,t.pay.total=0,$.each(t.pay.payList,function(e,n){t.pay.total+=parseInt(n.value)})},t.confirmPay=function(n){var a=t.pay;"cash"==n&&d.saveForCash(a,function(t){$("#studentAccountCashRechargePanel").modal("hide"),$("#studentAccountRechargePanel").modal("hide"),alert("充值成功!")},function(t){e.log(t),alert("系统现金缴费异常，请联系管理员，异常信息："+t.data.message)}),"card"==n&&d.saveForCard(a,function(t){$("#studentAccountRechargeCardPanel").modal("hide"),$("#studentAccountRechargePanel").modal("hide"),alert("充值成功!")},function(t){alert("系统刷卡充值异常，请联系管理员,异常信息："+t.data.message)}),"transfer"==n&&d.saveForTransfer(a,function(t){$("#studentAccountTransferPanel").modal("hide"),$("#studentAccountRechargePanel").modal("hide"),alert("充值成功!")},function(t){alert("系统转账充值异常，请联系管理员，异常信息："+t.data.message)})},t.studentListPage={pageSize:10,currentPage:1,totalPage:1},t.student_searchInfo=null,t.queryStudentList=function(){var e={};e.searchInfo=$("#student_search_info").val(),t.curStudent=null,t.studentList=[],f.query(e,function(e){"false"==e.error?t.studentList=e.data:alert("搜索学生信息异常，请联系管理员，异常信息："+e.message)})},t.queryStudentList(),t.curStudent=null,t.checkedStudent=function(e){e.checked?(e.checked=!1,t.curStudent&&t.curStudent.id==e.id&&(t.curStudent=null)):(t.curStudent&&t.curStudent.id!=e.id&&(t.curStudent.checked=!1),e.checked=!0,t.curStudent=e)},t.type="",t.studentTransferAcount={transferInStudent:{studentId:"",studentEncoding:"",studentName:"",studentType:"",studentAccount:"",studentAccountAfter:""},transferOutStudent:{studentId:"",studentEncoding:"",studentName:"",studentType:"",studentAccount:"",studentAccountAfter:""},transferAccount:0,transferRemark:""},t.studentList=[],t.toOpenAccountRechargePanel=function(e){t.curStudent=null,t.type=e,$("#studentSelectedPanel").modal("show")},t.studentSearch=function(t,e){if(t.student_list_name=void 0,t.student_list_encoding=void 0,"name"==e){var n={};n.searchInfo=t.studentName,n.currentPage=1,n.pageSize=100,f.query(n,function(e){"false"==e.error&&(t.student_list_name=e.data)})}else if("encoding"==e){var n={};n.searchInfo=t.studentEncoding,n.currentPage=1,n.pageSize=100,f.query(n,function(e){"false"==e.error&&(t.student_list_encoding=e.data)})}},t.selectStudent=function(e,n){e.student_list_name=null,e.student_list_encoding=null,e.studentEncoding=n.studentEncoding,e.studentName=n.studentName,e.studentId=n.id,e.studentAccountType=t.productList[0].id,t.checkedAccountType(e,t.productList[0])},t.parseInt=function(t){return parseInt(t)},t.checkedAccountType=function(t,e){t.studentAccountType=e.id;var n={};n.productLine=e.id,n.studentId=t.studentId,l.query(n,function(e){"false"==e.error&&(t.studentAccount=e.data.fee_amount)})},t.studentTransferStudentAccountPanel=function(){t.studentTransferAcount={transferInStudent:{studentEncoding:"",studentName:"",studentAccount:{},studentAccountAfter:{}},transferOutStudent:{studentEncoding:"",studentName:"",studentAccount:{},studentAccountAfter:{}},transferAccount:0,transferRemark:""},$("#studentTransferStudentAccountPanel").modal("show")},t.transferAccountChange=function(){t.studentTransferAcount.transferAccount>t.studentTransferAcount.transferInStudent.studentAccount[t.studentTransferAcount.transferInStudent.studentAccountType]&&(t.studentTransferAcount.transferAccount=t.studentTransferAcount.transferInStudent.studentAccount[t.studentTransferAcount.transferInStudent.studentAccountType])},t.confirmTransferAccount=function(){var e={transferInStudent:{studentEncoding:t.studentTransferAcount.transferInStudent.studentEncoding,studentName:t.studentTransferAcount.transferInStudent.studentName,studentAccountType:t.studentTransferAcount.transferInStudent.studentAccountType,studentAccount:t.studentTransferAcount.transferInStudent.studentAccount,studentAccountAfter:t.studentTransferAcount.transferInStudent.studentAccountAfter},transferOutStudent:{studentEncoding:t.studentTransferAcount.transferOutStudent.studentEncoding,studentName:t.studentTransferAcount.transferOutStudent.studentName,studentAccountType:t.studentTransferAcount.transferOutStudent.studentAccountType,studentAccount:t.studentTransferAcount.transferOutStudent.studentAccount,studentAccountAfter:t.studentTransferAcount.transferOutStudent.studentAccountAfter},transferAccount:t.studentTransferAcount.transferAccount,transferRemark:t.studentTransferAcount.transferRemark};c.post(e,function(e){"false"==e.error&&(t.studentTransferAcount=null,$("#studentTransferStudentAccountPanel").modal("hide"),alert("提交成功！"))})},t.openWithdrawPanel=function(){t.withDrawStudent={studentId:"",studentEncoding:"",studentName:"",studentCard:"",studentAmount:"",studentCounterFee:"",studentRemark:""},$("#studentAccountWithdrawPanel").modal("show")},t.withDrawStudent={studentId:"",studentEncoding:"",studentName:"",studentCard:"",studentAmount:"",studentCounterFee:"",studentRemark:""},t.confirmWithDraw=function(){var e={};e.studentId=t.withDrawStudent.studentId,e.studentEncoding=t.withDrawStudent.studentEncoding,e.studentName=t.withDrawStudent.studentName,e.studentCard=t.withDrawStudent.studentCard,e.money=t.withDrawStudent.studentAmount,e.moneyFee=t.withDrawStudent.studentCounterFee,e.remark=t.withDrawStudent.studentRemark,e.productLine=t.withDrawStudent.studentAccountType,s.withDraw(e,function(t){$("#studentAccountWithdrawPanel").modal("hide"),alert("保存成功！")},function(t){alert("取款功能异常，请联系管理员！异常信息："+t.data.message)})},t.settlementOfClaims={studentId:"",studentEncoding:"",studentName:"",studentAmount:"",studentRemark:""},t.openSettlementOfClaims=function(){t.settlementOfClaims={studentId:"",studentEncoding:"",studentName:"",studentAmount:"",studentRemark:""},$("#studentAccountSettlementOfClaimsPanel").modal("show")},t.confirmSettlementOfClaims=function(){var e={};e.studentId=t.settlementOfClaims.studentId,e.studentEncoding=t.settlementOfClaims.studentEncoding,e.studentName=t.settlementOfClaims.studentName,e.studentAmount=t.settlementOfClaims.studentAmount,e.studentRemark=t.settlementOfClaims.studentRemark,e.studentAccountType=t.settlementOfClaims.studentAccountType,s.get(e,function(t){"false"==t.error&&($("#studentAccountWithdrawPanel").modal("hide"),alert("保存成功！"))})},t.toAccountRechargePanel=function(e){return t.type=e,t.curStudent?($("#studentSelectedPanel").modal("hide"),$("#studentAccountRechargePanel").modal("hide"),void("cash"==e?(t.pay={total:0},$("#studentAccountCashRechargePanel").modal("show")):"card"==e?(t.pay={total:0,posList:t.posList},$("#studentAccountRechargeCardPanel").modal("show")):"transfer"==e?(t.pay={total:0,accountList:t.accountList},$("#studentAccountTransferPanel").modal("show")):$("#studentAccountRechargePanel").modal("show"))):void $("#studentSelectedPanel").modal("show")},t.queryInfo=function(){t.currentPage=1,m()},t.selectedPos=function(e){t.pay.companyAccount=e.accountName,t.pay.companyCard=e.companyCardId,t.pay.posName=e.name,t.pay.posId=e.id},t.selectedAccount=function(e){t.pay.companyAccount=e.name,t.pay.companyCard=e.id},t.initNumber=function(e){for(var n=new Array,a=1;a<=10&&a<=e;a++)n.push(a);t.paginationBars=n},t.queryIndex=function(e){(e<=0||e>t.totalPage)&&t.totalPage>0||(t.currentPage=e,m())},t.queryInfo(),y(),A(),g(),S(),h()}angular.module("ework-ui").controller("BSAccountMgrCtrl",["$scope","$log","$state","BranchsService","CompanyService","ProductService","PUBStudentAccountChangeService","PUBStudentAccountTransferService","PUBStudentAccountWithDrawService","PosService","CompanyAccountService","StudentAccountService","StudentQueryService",BSAccountMgrCtrl]);
function BSattendanceMgrCtrl(e,t,a,n,r,i,s,o,u,c,d,l){function g(){var t=new Array;if(e.currentPage==e.totalPage){for(var a=e.totalPage-9,n=a<0?1:a,r=n;r<=e.totalPage;r++)t.push(r);e.paginationBars=t}else if(1==e.currentPage)e.initNumber(e.totalPage);else{var i=e.paginationBars.length,s=e.paginationBars[i-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(i,1)):e.currentPage>s&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(i-1,0,s+1))}}function f(t){var a={};a.courseId=t.course_id,t.courseTimeInfoList=[],e.isAttendClassTime="loading...",d.query(a,function(a){e.isAttendClassTime="",t.courseTimeInfoList=a.data},function(e){alert("获取考勤课次信息异常！，请联系管理员！异常信息："+e.data.message)})}function m(){e.isLoadingAttendClass="loading...",e.attendClassList=[],e.queryParam.busiType=1,e.queryParam.rows=9,e.queryParam.pageSize=e.pageSize,e.queryParam.currentPage=e.currentPage,e.queryParam.totalPage=e.totalPage,c.query(e.queryParam,function(t){e.attendClassList=t.data,e.isLoadingAttendClass="",e.currentPage=t.currentPage,e.totalPage=t.totalPage,e.pageSize=t.pageSize,g()},function(e){alert("系统异常，请联系管理员！ 异常信息："+e.data.message)})}function P(){n.get({},function(t){"false"==t.error&&(e.productList=t.data)})}function S(){var t={};r.query(t,function(t){t.data.unshift({id:"-1",name:"全部"}),e.seasonList=t.data,e.selectedSeason=e.seasonList[0]},function(e){alert("异常:"+e.data.message+"请联系管理员！")})}function p(){i.get({},function(t){"false"==t.error&&(t.data.unshift({id:"-1",name:"全部"}),e.branchsList=t.data,e.selectedBranch=e.branchsList[0])})}function y(){s.get({},function(t){t.data.unshift({id:"-1",name:"全部"}),e.companys=t.data,e.selectedCompany=e.companys[0]},function(e){alert("请联系系统管理员！异常："+e.data.message)})}function h(){var t={};o.get(t,function(t){"false"==t.error&&(e.gradeList=t.data)})}function C(){var t={};u.get(t,function(t){"false"==t.error&&(e.subjectList=t.data)})}function v(){var t={};t.schedulingId=e.currentAttendClassTime.schedulingId,l.query(t,function(t){e.currentCourse.attendStudentList=t.data},function(e){alert("系统异常，请联系管理员！异常信息："+e.data.message)})}e.isLoadingAttendClass="",e.attendClassList=[],e.queryParam={},e.isShowSeniorQuery=!1,e.showCourseTimes=function(e){e.isShowCourseTimes?(e.isShowCourseTimes=!1,f(e)):(e.isShowCourseTimes=!0,f(e))},e.initNumber=function(t){for(var a=new Array,n=1;n<=10&&n<=t;n++)a.push(n);e.paginationBars=a},e.queryIndex=function(t){(t<=0||t>e.totalPage)&&e.totalPage>0||(e.currentPage=t,e.queryInfo())},e.showSeniorQuery=function(){e.isShowSeniorQuery?e.isShowSeniorQuery=!1:e.isShowSeniorQuery=!0},e.selectParam=function(t,a){e.queryParam[t]=a},e.queryInfo=function(){m()},e.toAttendListPanel=function(t,a){e.currentCourse=t,e.currentAttendClassTime=a,$("#attendCourseTimesStudentListPanel").modal("show"),v()},e.attendTypeChange=function(e,t){e.attendType=t},e.updateAttendType=function(){var t={},a=[];return $.each(e.currentCourse.attendStudentList,function(e,t){t.checked&&a.push(t)}),a&&a.length?(t.studentList=a,t.schedulingId=e.currentAttendClassTime.schedulingId,void l.update(t,function(e){alert("考勤成功！")},function(e){alert("请联系管理员，批量考勤异常，异常信息："+e.data.message)})):void alert("请选择要考勤的学员！")},e.coursetimeStudentList=null,m(),P(),S(),y(),p(),h(),C()}angular.module("ework-ui").controller("BSattendanceMgrCtrl",["$scope","$log","$state","ProductService","SeasonService","BranchsService","CompanyService","GradeService","SubjectService","PUBAttendanceCourseService","PUBAttendanceCourseTimeService","PUBAttendanceCoursetimeStudentService",BSattendanceMgrCtrl]);
function BSrefundCtrl(e,a,n,t,r,i){function o(){i.get({},function(a){"false"==a.error&&(e.companyList=a.data)})}function l(){r.get({},function(a){"false"==a.error&&(e.branchsList=a.data)})}function c(){var a={};a.pageSize=e.pageSize,a.currentPage=e.currentPage,a.totalPage=e.totalPage,a.p_startDate=$("#beginDate").val(),a.p_endDate=$("#endDate").val(),a.p_searchInfo=e.search_info,e.selectedCompany&&(a.p_selectedCompany=e.selectedCompany),e.selectedBranch&&(a.p_selectedBranch=e.selectedBranch),e.isLoadingOrders="loading...",t.get(a,function(a){e.isLoadingOrders="","false"==a.error?(e.refundList=a.data,e.currentPage=a.currentPage,e.totalPage=a.totalPage,e.pageSize=a.pageSize,s()):a.message&&alert("系统出现错误"+a.message+":请截图给管理员!")})}function s(){var a=new Array;if(e.currentPage==e.totalPage){for(var n=e.totalPage-9,t=n<0?1:n,r=t;r<=e.totalPage;r++)a.push(r);e.paginationBars=a}else if(1==e.currentPage)e.initNumber(e.totalPage);else{var i=e.paginationBars.length,o=e.paginationBars[i-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(i,1)):e.currentPage>o&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(i-1,0,o+1))}}e.refundList=[],e.currentPage=1,e.totalPage=1,e.pageSize=20,e.selectedBranch=null,e.selectedCompany=null,e.selectedRefund=null,e.queryInfo=function(){c()},e.toRefundCancel=function(a){e.selectedRefund=a,$("#refundCancelPanel").modal("show")},e.confirmDelete=function(){var a={};$.extend(a,e.selectedRefund),t.delete(a,function(e){"false"==e.error&&($("#refundCancelPanel").modal("hide"),alert("删除成功！"))})},e.cancelDelete=function(){$("#refundCancelPanel").modal("hide")},e.toRefundDetail=function(a){e.selectedRefund=a,$("#refundDetailPanel").modal("show")},e.queryBranchsWithId=function(a){var n={};a.id?n.companyId=a.id:n.companyId=a,r.get(n,function(a){"false"!=a.error&&0!=a.error||(e.branchsList=a.data)})},e.initNumber=function(a){for(var n=new Array,t=1;t<=10&&t<=a;t++)n.push(t);e.paginationBars=n},e.queryIndex=function(a){(a<=0||a>e.totalPage)&&e.totalPage>0||(e.currentPage=a,c())},o(),l(),c()}angular.module("ework-ui").controller("BSrefundCtrl",["$scope","$log","$state","RefundService","BranchsService","CompanyService",BSrefundCtrl]);
function BSrefund2refundCtrl(e,r,u,o,c,t,s,n,d){function i(){var r={};r.studentId=e.curStudent.id,r.courseId=e.curCourse.courseId,r.orderCourseId=e.curCourse.orderCourseId,d.get(r,function(r){"false"==r.error&&(e.selectedCourseTimesList=r.data)})}function a(){var r={};r.searchInfo=e.page.searchInfo,s.get(r,function(r){"false"==r.error&&(e.studentList=r.data)})}function f(){var u={};u.p_studentId=e.curStudent.id,r.log("cur studentId is "+e.curStudent.id),n.get(u,function(r){if("false"==r.error){var u=r.data;if(u&&u.length){var o=[];$.each(u,function(e,r){r.orderCourseList&&r.orderCourseList.length&&$.each(r.orderCourseList,function(e,u){o.push({orderId:r.id,orderNo:r.order_no,schId:u.sch_id,courseName:u.course.course_name,courseId:u.course_id,orderCourseId:u.id,unitPrice:u.former_unit_price,discountUnitPrice:u.discount_unit_price,actualPrice:u.discount_sum_price,totalPrice:u.former_sum_price,forward:u.forward,courseTimes:u.courseTimes,rootCourseId:u.root_course_id,teacherName:u.teacher.teacher_name,teacherCode:u.teacher.encoding,startTime:u.course.start_time,endTime:u.course.end_time,totalCourseTimes:u.course_total_count})})}),e.selectedCourseList=o}}})}function C(r){r.orderLog={},r.orderLog.order_id=e.curCourse.orderId,r.orderLog.ref_course_count=e.curCoursetime.length,r.orderLog.fee_amount=e.allRefund}function l(r){r.courseLog={},r.courseLog.order_id=r.orderLog.orderId,r.courseLog.order_course_id=e.curCourse.orderCourseId,r.courseLog.root_course_id=e.curCourse.rootCourseId,r.courseLog.sch_id=e.curCourse.schId,r.courseLog.former_unit_price=e.curCourse.unitPrice,r.courseLog.discount_unit_price=e.curCourse.discountUnitPrice,r.courseLog.course_total_count=e.curCourse.totalCourseTimes,r.courseLog.course_surplus_count=e.curCourse.totalCourseTimes-e.curCoursetime.length,r.courseLog.fee_deduction_amount=e.premiumDeduction,m(r.courseLog)}function m(u){var o=[];angular.forEach(e.curCoursetime,function(e){o.push({course_times:e.courseTime,order_course_id:u.order_course_id})}),r.log(o),u.courseTimesLogs=JSON.parse(JSON.stringify(o))}function h(){var e={};return C(e),l(e),e}e.step=1,e.studentList=[],e.queryStudent=function(){a()},e.curStudent=null,e.selectedCourseList=[],e.selectedCourseTimesList=[],e.refund={premiumDeduction:null,refundRemark:null},e.page={searchInfo:null},e.checkedStudent=function(r){r.checked?(r.checked=!1,e.curStudent&&e.curStudent.id==r.id&&(e.curStudent=null)):(e.curStudent&&e.curStudent.id!=r.id&&(e.curStudent.checked=!1),r.checked=!0,e.curStudent=r)},e.checkedCourse=function(r){r.checked?(r.checked=!1,e.curCourse&&e.curCourse.courseId==r.courseId&&(e.curCourse=null)):(e.curCourse&&e.curCourse.courseId!=r.courseId&&(e.curCourse.checked=!1),r.checked=!0,e.curCourse=r)},e.curCoursetime=[],e.checkedTimes=function(r){r.checked?r.checked=!1:r.checked=!0,e.curCoursetime=[],$.each(e.selectedCourseTimesList,function(r,u){u.checked&&e.curCoursetime.push(u)})},e.nextStep=function(u,o){if(e.step=o,2==o&&(f(),r.log("step 2")),3==o&&i(),4==o){var c="";$.each(e.curCoursetime,function(e,r){e>0&&(c+="，"),c+=r.courseTime}),e.curCoursetimeStr=c,e.allRefund=parseInt(e.curCourse.totalPrice)-parseInt(e.curCourse.unitPrice)*(parseInt(e.curCourse.totalCourseTimes)-parseInt(e.curCoursetime.length))}},e.queryStudentOnChange=function(){e.onGoingQuery=!0,a()},e.selectedStudent=function(r){angular.forEach(e.studentList,function(u){if(r.id==u.id)return u.checked=!0,void(e.curStudent=r)}),e.onGoingQuery=!1},e.postRefund=function(){var r={};e.isLoading=!0,r.curStudent=e.curStudent,r.curCourse=e.curCourse,r.curCoursetime=e.curCoursetime,r.premiumDeduction=e.refund.premiumDeduction,r.refundRemark=e.refund.refundRemark,o.post(h(),function(r){"false"==r.error?(alert("保存成功！"),location.href="#/businessSystem/refundMgr"):(r.message&&alert("退费提交发生错误:"+r.message+"....请截图给管理员!"),e.isLoading=!1)})},a()}angular.module("ework-ui").controller("BSrefund2refundCtrl",["$scope","$log","$state","RefundService","BranchsService","CompanyService","StudentQueryService","OrdersPubService","StudentCourseTimeStateService",BSrefund2refundCtrl]);
function BSsuchMgrCtrl(r,e,a,t,c,n,o,u,s,d,i,l){function f(){n.get({},function(e){"false"==e.error&&(r.companyList=e.data)})}function h(e){var a={};a.companyId=e,c.get(a,function(e){r.isLoadingBranchListSelected="","false"==e.error&&(r.branchsList=e.data)})}function g(){c.get({},function(e){"false"==e.error&&(r.branchsList=e.data)})}function I(){d.get({},function(e){"false"==e.error&&(r.productList=e.data,r.productList&&r.productList.length&&(r.queryCourseParam.productId=r.productList[0].id))})}function v(){var e={};r.shcId&&null!=r.shcId&&(e.schId=r.shcId),u.get(e,function(e){"false"==e.error&&(r.seasonList=e.data)})}function S(){var e={};r.shcId&&null!=r.shcId&&(e.schId=r.shcId),s.get(e,function(e){"false"==e.error&&(r.subjectList=e.data)})}function y(){var e={};r.shcId&&null!=r.shcId&&(e.schId=r.shcId),o.get(e,function(e){"false"==e.error&&(r.gradeList=e.data)})}function L(){v(),y(),S()}r.queryCourseParam={},r.suchData=[],r.isLoad="",r.pageSearch={startDate:null,endDate:null},r.query=function(){var e=r.queryCourseParam;""!=$("#beginDate").val()&&(e.startDate=$("#beginDate").val()),""!=$("#endDate").val()&&(e.endDate=$("#endDate").val()),r.isLoad="loading",i.query(e,function(e){r.isLoad="","false"==e.error&&(r.suchData=e.data)})},r.extPort=function(e,a){var t=r.queryCourseParam;t.modelId=a,"1"==r.queryCourseParam.productId&&(t.courseId=e.courseId),l.get(t,function(r){alert("导出成功!")})},r.checkCondition=function(a,t){r.queryCourseParam[a]=t,"companyId"==a?(e.log("start query branc.hs.........."+t),h(t)):"branchId"==a&&(r.shcId=t,e.log("start query branchs..........."+t),L()),r.query()},I(),y(),S(),v(),g(),f(),r.query()}angular.module("ework-ui").controller("BSsuchMgrCtrl",["$scope","$log","$state","RefundService","BranchsService","CompanyService","GradeService","SeasonService","SubjectService","ProductService","PUBSuchService","PUBExportService",BSsuchMgrCtrl]);
function BStransferClassMgrCtrl(a,e,r,t,n,s){function i(){s.get({},function(e){"false"==e.error&&(a.companyList=e.data)})}function o(){n.get({},function(e){"false"==e.error&&(a.branchsList=e.data)})}function c(){a.transferClassList=[];var e={};e.pageSize=a.pageSize,e.currentPage=a.currentPage,e.totalPage=a.totalPage,e.p_searchInfo=a.search_info,a.selectedCompany&&(e.p_selectedCompany=a.selectedCompany),a.selectedBranch&&(e.p_selectedBranch=a.selectedBranch),e.p_startDate=$("#beginDate").val(),e.p_endDate=$("#endDate").val(),a.isLoadingOrders="loading...",t.get(e,function(e){a.isLoadingOrders="","false"==e.error&&(a.transferClassList=e.data,a.currentPage=e.currentPage,a.totalPage=e.totalPage,a.pageSize=e.pageSize,g())})}function g(){var e=new Array;if(a.currentPage==a.totalPage){for(var r=a.totalPage-9,t=r<0?1:r,n=t;n<=a.totalPage;n++)e.push(n);a.paginationBars=e}else if(1==a.currentPage)a.initNumber(a.totalPage);else{var s=a.paginationBars.length,i=a.paginationBars[s-1];a.currentPage<a.paginationBars[0]?(a.paginationBars.splice(0,0,a.paginationBars[0]-1),a.paginationBars.splice(s,1)):a.currentPage>i&&a.currentPage<a.totalPage&&(a.paginationBars.splice(0,1),a.paginationBars.splice(s-1,0,i+1))}}a.transferClassList=[],a.companyList=[],a.branchsList=[],a.paginationBars=[],a.queryInfo=function(e){e&&(a.currentPage=e),c()},a.queryBranchsWithCompany=function(e){var r={};e.id?r.companyId=e.id:r.companyId=e,n.get(r,function(e){"false"!=e.error&&0!=e.error||(a.branchsList=e.data)})},a.initNumber=function(e){for(var r=new Array,t=1;t<=10&&t<=e;t++)r.push(t);a.paginationBars=r},a.queryIndex=function(e){(e<=0||e>a.totalPage)&&a.totalPage>0||(a.currentPage=e,c())},c(),i(),o()}angular.module("ework-ui").controller("BStransferClassMgrCtrl",["$scope","$log","$state","TransferClassService","BranchsService","CompanyService",BStransferClassMgrCtrl]);
function BStransferClassMgr2transferClassCtrl(e,r,t,s,u,n,o,c,d,a,i,f,C,l){function I(){var r={};r.searchInfo=e.page.searchInfo,i.get(r,function(r){"false"==r.error&&(e.studentList=r.data)})}function m(){var r={};$.extend(r,e.queryCourseParam),e.selectingCourseList=[],C.get(r,function(r){if("false"==r.error){var t=r.data;t&&t.length&&$.each(t,function(r,t){t.actual_price=t.unit_price;var s=!1;$.each(e.transferInCourseList,function(e,r){t.id==r.id&&(s=!0)}),s||e.selectingCourseList.push(t)})}})}function h(){u.get({},function(r){"false"==r.error&&(e.productList=r.data,e.productList&&e.productList.length&&(e.queryCourseParam.productId=e.productList[0].id))})}function O(){var r={};e.shcId&&null!=e.shcId&&(r.schId=e.shcId),d.get(r,function(r){"false"==r.error&&(e.gradeList=r.data)})}function p(){c.get({},function(r){"false"==r.error&&(e.companyList=r.data)})}function _(){var r=e.queryCourseParam.companyId,t={};t.companyId=r,o.get(t,function(r){"false"==r.error&&(e.branchsList=r.data)})}function g(){L(),O(),S()}function L(){var r={};e.shcId&&null!=e.shcId&&(r.schId=e.shcId),n.get(r,function(r){"false"==r.error&&(e.seasonList=r.data)})}function O(){var r={};e.shcId&&null!=e.shcId&&(r.schId=e.shcId),d.get(r,function(r){"false"==r.error&&(e.gradeList=r.data)})}function S(){var r={};e.shcId&&null!=e.shcId&&(r.schId=e.shcId),a.get(r,function(r){"false"==r.error&&(e.subjectList=r.data)})}function T(){var r={};r.p_studentId=e.curStudent.id,e.queryCourseParam.productId&&(r.p_productId=e.queryCourseParam.productId),e.queryCourseParam.seasonId&&(r.p_seasonId=e.queryCourseParam.seasonId),f.get(r,function(r){var t=r.data;if(t&&t.length){var s=[];$.each(t,function(e,r){r.orderCourseList&&r.orderCourseList.length&&$.each(r.orderCourseList,function(e,t){s.push({orderId:r.id,orderNo:r.order_no,courseName:t.course.course_name,courseId:t.course_id,orderCourseId:t.id,unitPrice:t.former_unit_price,actualPrice:t.discount_sum_price,totalPrice:t.former_sum_price,forward:t.forward,courseTimes:t.courseTimes,teacherName:t.teacher.teacher_name,teacherCode:t.teacher.encoding,startTime:t.course.start_time,endTime:t.course.end_time,totalCourseTimes:t.course_total_count})})}),e.selectedCourseList=s}})}function v(){var r={};r.p_studentId=e.curStudent.id,r.courseId=e.curCourse.courseId,r.orderCourseId=e.curCourse.orderCourseId,l.get(r,function(r){"false"==r.error&&(e.selectedCourseTimesList=r.data,e.currentOrderCourse.orderId=e.selectedCourseTimesList[0].orderId,e.currentOrderCourse.orderNo=e.selectedCourseTimesList[0].orderNo)})}function k(){var r={},t=e.transferInCourseList[0].id;r.courseId=t,C.queryCourseTimes(r,function(r){"false"==r.error&&(e.transferInCourseTimesList=r.data)})}function x(){var r="";$.each(e.curCoursetime,function(e,t){e>0&&(r+=","),r+=t.courseTime}),e.transferOutCoursetimesStr=r}function P(){var r="";$.each(e.curTransferInCoursetime,function(e,t){e>0&&(r+=","),r+=t.courseTime}),e.curTransferInCoursetimeStr=r}function y(r){var t={};t.transferOutOrder=r.transferOut,t.transferInOrder={},$.extend(t.transferOutOrder,{id:e.selectedCourseList[0].orderCourseId}),$.extend(t.transferOutOrder,{order_id:e.selectedCourseList[0].orderId});var s=e.curCoursetime.length;$.extend(t.transferOutOrder,{course_total_count:s});var u=(e.transferInCourseTimesList.length,e.selectedCourseList[0].unitPrice);$.extend(t.transferOutOrder,{course_surplus_count:s}),$.extend(t.transferOutOrder,{surplus_cost:s*u}),$.extend(t.transferOutOrder,{former_sum_price:s*u}),$.extend(t.transferOutOrder,{discount_sum_price:t.transferOutOrder.former_sum_price}),$.extend(t.transferOutOrder,{courseTimes:e.curTransferInCoursetime.length}),$.extend(t.transferOutOrder,{sch_id:e.shcId});var n=e.transferInCourseList[0].id;$.extend(t.transferInOrder,{course_id:n}),$.extend(t.transferInOrder,{root_course_id:e.curCourse.orderCourseId});var s=e.curCoursetime.length;$.extend(t.transferInOrder,{course_total_count:s});e.selectedCourseList.length;return $.extend(t.transferInOrder,{course_surplus_count:s}),$.extend(t.transferInOrder,{former_unit_price:t.transferOutOrder.unitPrice}),$.extend(t.transferInOrder,{discount_sum_price:t.transferOutOrder.actualPrice}),$.extend(t.transferInOrder,{former_sum_price:t.transferOutOrder.totalPrice}),$.extend(t.transferInOrder,{courseTimes:e.curCoursetime.length}),$.extend(t.transferInOrder,{order_id:t.transferOutOrder.orderId}),$.extend(t.transferInOrder,{branch_id:e.queryCourseParam.branchId}),$.extend(t.transferInOrder,{sch_id:e.shcId}),b(t),q(t),B(t),N(t),t}function b(r){var t=[];angular.forEach(e.curCoursetime,function(e){t.push({times:e.courseTime,isValid:1})}),$.extend(r.transferOutOrder,{orderCourseTimes:t})}function q(r){var t=[];angular.forEach(e.curTransferInCoursetime,function(e){t.push({times:e.courseTime,isValid:1})}),$.extend(r.transferInOrder,{orderCourseTimes:t})}function N(r){r.pubTransferInOrderLog={},r.pubTransferInOrderLog.order_id=r.transferInOrder.orderId,r.pubTransferInOrderLog.ref_course_count=e.curCoursetime.length,r.pubTransferInOrderLog.fee_amount=r.transferInOrder.totalPrice}function B(r){r.pubTransferOutOrderLog={},r.pubTransferOutOrderLog.order_id=r.transferOutOrder.orderId,r.pubTransferOutOrderLog.ref_course_count=e.curTransferInCoursetime.length,r.pubTransferOutOrderLog.fee_amount=r.transferOutOrder.actualPrice}e.step=1,e.studentList=[],e.curStudent=null,e.toSelectedCourseState="courseUp",e.queryCourseParam={},e.selectedCourseList=[],e.transferInCourseList=[],e.curCourse=null,e.transferInCourse=null,e.curCoursetime=[],e.curTransferInCoursetime=[],e.transferOutCoursetimesStr="",e.curTransferInCoursetimeStr="",e.currentOrderCourse={orderId:"",orderNo:""},e.remark=null,e.page={searchInfo:null},e.shcId=null,e.nextStep=function(t,s){e.step=s,2==s&&(T(),r.log("step 2")),3==s&&(v(),k())},e.queryStudent=function(){I()},e.checkedStudent=function(r){r.checked?(r.checked=!1,e.curStudent&&e.curStudent.id==r.id&&(e.curStudent=null)):(e.curStudent&&e.curStudent.id!=r.id&&(e.curStudent.checked=!1),r.checked=!0,e.curStudent=r)},e.toSelectedCourse=function(){"courseUp"==e.toSelectedCourseState?(e.toSelectedCourseState="courseDown",m()):e.toSelectedCourseState="courseUp"},e.checkCondition=function(r,t){e.queryCourseParam[r]=t,"productId"==r||"seasonId"==r?T():("companyId"==r?_():"branchId"==r&&(e.shcId=t,g()),m())},e.checkedCourse=function(r){for(var t in e.selectedCourseList)e.selectedCourseList[t].checked=!1;r.checked?(r.checked=!1,e.curCourse&&e.curCourse.courseId==r.courseId&&(e.curCourse=null)):(e.curCourse&&e.curCourse.courseId!=r.courseId&&(e.curCourse.checked=!1),r.checked=!0,e.curCourse=r)},e.selectedCourse=function(r){e.transferInCourseList&&0==e.transferInCourseList.length?(e.transferInCourseList.push(r),e.toSelectedCourse(),e.transferInCourse=r,$.extend(e.transferInCourse,{actualPrice:e.curCourse.unitPrice}),m()):alert("已经选择了转入课程！")},e.queryStudentOnChange=function(){e.onGoingQuery=!0,I()},e.selectedStudent=function(r){angular.forEach(e.studentList,function(t){if(r.id==t.id)return t.checked=!0,void(e.curStudent=r)}),e.onGoingQuery=!1},e.removeCourse=function(r){var t=[];$.each(e.transferInCourseList,function(e,s){s.id!=r.id&&t.push(s)}),e.transferInCourseList=t,e.transferInCourse=null,m()},e.checkedTimes=function(r){r.checked?r.checked=!1:r.checked=!0,e.curCoursetime=[],$.each(e.selectedCourseTimesList,function(r,t){t.checked&&e.curCoursetime.push(t)}),e.transferInCourse.courseTimes=e.curCoursetime.length,e.transferInCourse.totalPrice=e.curCoursetime.length*parseInt(e.transferInCourse.actualPrice),x()},e.checkedTransferInTimes=function(r){r.checked?r.checked=!1:r.checked=!0,e.curTransferInCoursetime=[],$.each(e.transferInCourseTimesList,function(r,t){t.checked&&e.curTransferInCoursetime.push(t)}),P()},e.submitTransferCourse=function(){var r={};1==e.isLoading,r.student=e.curStudent,r.transferOut=e.curCourse,r.transferIn=e.transferInCourse,r.transferOutCourseTime=e.curCoursetime,r.transferInCourseTime=e.curTransferInCoursetime,r.remark=e.remark,s.post(y(r),function(r){"false"==r.error&&(alert("转班成功！"),location.href="#/businessSystem/BStransferClassMgr"),0==e.isLoading})},h(),L(),p(),_(),S(),O()}angular.module("ework-ui").controller("BStransferClassMgr2transferClassCtrl",["$scope","$log","$state","TransferClassService","ProductService","SeasonService","BranchsService","CompanyService","GradeService","SubjectService","StudentQueryService","OrdersPubService","CourseService","StudentCourseTimeStateService",BStransferClassMgr2transferClassCtrl]);
function CampusBelongingCtrl(e,c,n,a,r){function t(){a.get({},function(c){"false"==c.error&&(e.companyList=c.data)})}function i(){a.queryAreas({},function(c){"false"==c.error&&(e.areaList=c.data)})}function o(c){var n={};n.companyId=c.id,c.branchsList||(c.branchsList=[],e.isLoadingBranchListSelected="loading...",r.get(n,function(n){e.isLoadingBranchListSelected="","false"==n.error&&(c.branchsList=n.data)}))}function s(){var n={};e.branchsList=[],e.isLoadingBranchList="loading...",c.log("begin to query branchs."),r.get(n,function(n){if(e.isLoadingBranchList="",c.log("found branchs."),"false"==n.error){var a=[],r=n.data;$.each(r,function(c,n){var r=!1;$.each(e.checkedCompany.branchsList,function(e,c){n.id==c.id&&(r=!0)}),r||a.push(n)}),e.branchsList=a}})}e.companyList=[],e.branchsList=[],e.areaList=[],e.teamList=[],e.branchsListSelected=[],e.checkedCompany=null,e.isAllSelected=0,e.comfirmSubmit=function(){if(!e.checkedCompany)return void alert("请选择要修改的公司！");var n={};n=e.checkedCompany,n.schools=e.checkedCompany.branchsList,n.companyId=e.checkedCompany.id,c.log(n),a.update(n,function(e){"false"==e.error&&alert("修改成功！")})},e.toAddSelectedBranchPanel=function(){return e.checkedCompany?($("#addBranchListPanel").modal("show"),void s()):void alert("请选择公司！")},e.checked=function(n){e.checkedCompany&&e.checkedCompany.id!=n.id&&(e.checkedCompany.checked=!1),n.checked?n.checked=!1:(n.checked=!0,e.checkedCompany=n,c.log("start query branch"),o(n))},e.checkedRow=function(e){e.checked?e.checked=!1:e.checked=!0},e.removeRow=function(c){var n=[];e.checkedCompany.branchsList&&e.checkedCompany.branchsList.length&&($.each(e.checkedCompany.branchsList,function(e,a){c.id!=a.id&&n.push(a)}),e.checkedCompany.branchsList=n)},e.addBranch=function(){if(!e.branchsList)return void alert("异常数据！请联系管理员！");var c=!1;return e.uncheckedBranchsList=[],$.each(e.branchsList,function(n,a){a.checked?(c=!0,e.checkedCompany.branchsList||(e.checkedCompany.branchsList=[]),e.checkedCompany.branchsList.push(a)):e.uncheckedBranchsList.push(a)}),e.branchsList=e.uncheckedBranchsList,c?void 0:void alert("请选择校区！")},e.toggleAll=function(){e.isAllSelected=0==e.isAllSelected,$.each(e.branchsList,function(c,n){n.checked=e.isAllSelected})},e.queryTeams=function(n){var r={};r.parentId=n.id,c.log(r.parentId),a.querySubOrg(r,function(c){"false"==c.error&&(e.teamList=c.data)})},e.queryBranchs=function(c){var n={};n.parentId=c.id,a.querySubOrg(n,function(c){"false"==c.error&&(e.branchsList=c.data)})},t(),i()}angular.module("ework-ui").controller("CampusBelongingCtrl",["$scope","$log","$state","CompanyService","BranchsService",CampusBelongingCtrl]);
function CountAccomplishmentEverydayCtrl(e,a,t,r,n,i){function o(){var a=new Array;if(e.currentPage==e.totalPage){for(var t=e.totalPage-9,r=t<0?1:t,n=r;n<=e.totalPage;n++)a.push(n);e.paginationBars=a}else if(1==e.currentPage)e.initNumber(e.totalPage);else{var i=e.paginationBars.length,o=e.paginationBars[i-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(i,1)):e.currentPage>o&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(i-1,0,o+1))}}function c(){n.get({},function(a){"false"==a.error&&(a.data.unshift({id:"-1",name:"全部"}),e.branchsList=a.data,e.selectedBranch=e.branchsList[0])})}function l(){r.get({},function(a){"false"==a.error&&(a.data.unshift({id:"-1",name:"全部"}),e.companys=a.data,e.selectedCompany=e.companys[0])})}function s(){if(!e.selectedCompany)return void alert("请选择公司！");if(!e.selectedBranch)return void alert("请选择校区！");if(!e.st)return void alert("开始时间必须录入！");if(!e.dt)return void alert("截止时间必须录入！");var t={};t.pageSize=e.pageSize,t.currentPage=e.currentPage,t.totalPage=e.totalPage,t.reportType="queryCountAccomplishmentEveryday",t.search_info=e.search_info,t.calcBeginDate=$("#beginDate").val(),t.calcEndDate=$("#endDate").val(),t.companyId=e.selectedCompany.id,t.branchId=e.selectedBranch.id,t.isWfd=$("#isWfd").prop("checked"),e.isLoadingOrders="loading...",e.reportData=[],i.query(t,function(t){e.reportData=t.data,e.currentPage=t.currentPage,e.totalPage=t.totalPage,e.pageSize=t.pageSize,o(),a.log("pageSize is"+e.pageSize+",totalPage is "+e.totalPage+",currentPage"+e.currentPage),e.isLoadingOrders=""},function(a){alert("异常:"+a.data.message+"请联系管理员！"),e.isLoadingOrders=""})}e.companys=[],e.reportData=[],e.st=new Date,e.dt=new Date,e.search_info="",e.queryInfo=function(){e.currentPage=1,s()},e.getNumber=function(e){for(var a=new Array,t=0;t<e;t++)a.push(t+1);return a},e.initNumber=function(a){for(var t=new Array,r=1;r<=10&&r<=a;r++)t.push(r);e.paginationBars=t},e.queryIndex=function(a){(a<=0||a>e.totalPage)&&e.totalPage>0||(e.currentPage=a,s())},e.exp=function(){if(!e.selectedCompany)return void alert("请选择公司！");if(!e.selectedBranch)return void alert("请选择校区！");if(!e.st)return void alert("开始时间必须录入！");if(!e.dt)return void alert("截止时间必须录入！");if(confirm("确定要导出?")){var a="?companyId="+e.selectedCompany.id+"&branchId="+e.selectedBranch.id+"&isWfd="+$("#isWfd").prop("checked")+"&calcBeginDate="+$("#beginDate").val()+"&calcEndDate="+$("#endDate").val();window.open("excels/output/outExcelCountaccomplishmenteveryday"+a,"_blank")}},l(),c()}angular.module("ework-ui").directive("block",["$compile",function(e){return{restrict:"E",template:"",transclude:!0}}]).controller("CountAccomplishmentEverydayCtrl",["$scope","$log","$state","CompanyService","BranchsService","ReportService",CountAccomplishmentEverydayCtrl]);
function DictCtrl(e,t,d,a,c){function i(t){$.each(e.dictSubDatas,function(d,a){a.id==t&&e.dictSubDatas.splice(d,1)})}function m(){var d={};a.get(d,function(d){"false"!=d.error&&0!=d.error||(t.log(d.data[0].items),e.dictDatas=d.data)})}e.dictDatas=[],e.dictTypeDatas=[],e.saveDicTypeItem=[],e.selectedRow=null,e.itemOperateType="",e.selectedTypeItem={},e.selectedItem={},e.singleCheckRow=function(t){$.each(e.dictDatas,function(e,t){t.checked=!1}),t.checked?t.checked=!1:(t.checked=!0,e.dictSubDatas=t.items,t.items||(e.dictSubDatas=[]))},e.toAddTypeItem=function(){e.itemOperateType="add",$("#dictTypeItemPanel").modal("show")},e.toAddItem=function(){var t=null;$.each(e.dictDatas,function(e,d){d.checked&&(t=d)}),t?(e.selectedRow=t,e.selectedItem={},e.itemOperateType="add",$("#dictItemPanel").modal("show")):alert("请选择左侧字典类型！")},e.toUpdateItem=function(t){var d=null;$.each(e.dictDatas,function(e,t){t.checked&&(d=t)}),d?(e.selectedRow=d,e.selectedItem=t,e.itemOperateType="update",$("#dictItemPanel").modal("show")):alert("请选择左侧字典类型！")},e.toDeleteItem=function(t){var d=confirm("确认删除吗?");d&&e.deleteSubItem(t)},e.addDicTypeItem=function(){t.log("item name is "+e.selectedTypeItem.name+",remark is "+e.selectedTypeItem.remark),e.selectedTypeItem.typeId=e.selectedRow.id,DictTypeItemService.add(e.selectedTypeItem,function(t){"false"==t.error?($("#dictTypeItemPanel").modal("hide"),alert("添加成功！"),e.selectedTypeItem.id=t.id,e.dictTypeDatas[e.dictTypeDatas.length]=e.selectedTypeItem):alert("添加失败！失败信息："+t.message)})},e.saveDicTypeItem=function(){e.addDicTypeItem()},e.addSubItem=function(){t.log("item name is "+e.selectedItem.name+",remark is "+e.selectedItem.remark),e.selectedItem.typeId=e.selectedRow.id,c.add(e.selectedItem,function(t){"false"==t.error?($("#dictItemPanel").modal("hide"),alert("添加成功！"),e.selectedItem.id=t.id,e.dictSubDatas[e.dictSubDatas.length]=e.selectedItem):alert("添加失败！失败信息："+t.message)})},e.updateSubItem=function(){t.log("item name is "+e.selectedItem.name+",remark is "+e.selectedItem.remark),e.selectedItem.type=e.selectedRow.id,c.update(e.selectedItem,function(e){"false"==e.error||0==e.error?($("#dictItemPanel").modal("hide"),alert("修改成功！")):alert("添加失败！失败信息："+e.message)})},e.deleteSubItem=function(d){t.log(d.id),e.selectedItem.id=d.id,c.remove(e.selectedItem,function(e){"false"==e.error||0==e.error?($("#dictItemPanel").modal("hide"),alert("删除成功！"),i(d.id)):alert("添加失败！失败信息："+e.message)})},e.saveItem=function(){"add"==e.itemOperateType?e.addSubItem():"update"==e.itemOperateType?e.updateSubItem():"delete"==e.itemOperateType&&e.deleteSubItem()},m()}angular.module("ework-ui").controller("DictCtrl",["$scope","$log","$state","DictsService","DictItemService","DictTypeItemService",DictCtrl]);
function FileUpLoadCtrl(e,l,a,r,i){function t(){var l={};r.get(l,function(l){"false"!=l.error&&0!=l.error||(e.fileList=l.data)})}e.isLoading="",e.loaded=!1,e.modelId=null,e.test="1",e.datas=null,e.child={},e.fileUpload=function(){if(e.error_info="",!$("#fileUploader").val())return alert("请选择要导入的excel！"),void(e.error_info="请选择要导入的excel！");if(!$("#fileUploader").val().endsWith(".xls")&&!$("#fileUploader").val().endsWith(".xlsx"))return alert("请选择.xls格式的文件！"),void(e.error_info="请选择.xls或者.xlsx格式的文件！");var l=null;return e.fileList&&$.each(e.fileList,function(e,a){a.checked&&(l=!0)}),l?(e.isLoading="loading...",void $.ajaxFileUpload({url:"excels/inputview/input/"+e.modelId,secureuri:!1,fileElementId:"fileUploader",dataType:"json",success:function(l){e.isLoading="",l.message&&alert(l.message),e.step="two",e.$apply(),e.cols=l.cols,e.datas=l.data,e.loaded=!0},error:function(l,a,r){e.isLoading="",alert("上传失败！"),e.step="two",e.$apply()}})):(alert("请选择模版！"),void(e.error_info="请选择对应的excel模版！"))},$checkedIndex=-1,e.checkedFile=function(l,a){$checkedIndex!=-1&&(e.fileList[$checkedIndex].checked=!1),l.checked=!l.checked,e.modelId=l.id,$checkedIndex=a},e.checkData=function(e){e.checked?e.checked=!1:e.checked=!0},e.checkAllRows=function(){var a=e.child.currentPage,r=e.child.itemsPerPage,i=e.datas.slice((a-1)*r,a*r);l.log(i.length+"=="+e.child.itemsPerPage),e.checkAll?($.each(i,function(e,l){0!=e&&(l.checked=!1)}),e.checkAll=!1):($.each(i,function(e,l){0!=e&&(l.checked=!0)}),e.checkAll=!0)},e.submit=function(){var l={};if(!e.datas||!e.datas.length)return void alert("没有数据.");var a=!0,r=new Array;return $.each(e.datas,function(e,l){l.checked&&("true"!=l.result&&(a=!1,alert("第"+(e+1)+"行数据不合法!")),r.push(l))}),r.length?void(a&&(l.dataRow=JSON.parse(JSON.stringify(r)),l.modelId=e.modelId,i.add(l,function(e){"false"!=e.error&&0!=e.error||alert("保存成功！"),e.message&&alert("erro:"+e.message)}).error(function(e,l,a,r){alert(l),(l="404")&&alert("服务器已停止服务,请联系管理员!"),e.message&&alert(e.message)}))):void alert("请选择要提交的数据！")},e.returnBack=function(){e.step="one",e.isLoading=""},e.step="one",e.fileList=[],t()}angular.module("ework-ui").controller("FileUpLoadCtrl",["$scope","$log","$state","FileUploadService","FileUploadDataService",FileUpLoadCtrl]);
function LeftCourseTimesCtrl(e,a,r,t,n,i){function o(){t.get({},function(a){"false"==a.error&&(e.companyList=a.data)})}function c(){n.get({},function(a){"false"==a.error&&(e.branchsList=a.data)})}function s(){var a=new Array;if(e.currentPage==e.totalPage){for(var r=e.totalPage-9,t=r<0?1:r,n=t;n<=e.totalPage;n++)a.push(n);e.paginationBars=a}else if(1==e.currentPage)e.initNumber(e.totalPage);else{var i=e.paginationBars.length,o=e.paginationBars[i-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(i,1)):e.currentPage>o&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(i-1,0,o+1))}}function u(){var r={};r.rows=19,r.reportType="queryLeftCourseTimes",r.pageSize=e.pageSize,r.currentPage=e.currentPage,r.totalPage=e.totalPage,r.search_info=e.search_info,r.selectedCompany=e.selectedCompany,r.selectedBranch=e.selectedBranch,r.isWfd=$("#isWfd").prop("checked"),e.isLoadingOrders="loading...",e.reportData=[],i.query(r,function(r){e.reportData=r.data,e.currentPage=r.currentPage,e.totalPage=r.totalPage,e.pageSize=r.pageSize,s(),a.log("pageSize is"+e.pageSize+",totalPage is "+e.totalPage+",currentPage"+e.currentPage),e.isLoadingOrders=""},function(a){alert("异常:"+a.data.message+"请联系管理员！"),e.isLoadingOrders=""})}e.reportData=[],e.paginationBars=[],e.initPageNumber=!1,e.selectedBranch=null,e.selectedCompany=null,e.search_info="",e.queryInfo=function(){e.currentPage=1,u()},e.getNumber=function(e){for(var a=new Array,r=0;r<e;r++)a.push(r+1);return a},e.queryBranchsWithId=function(a){var r={};a.id?r.companyId=a.id:r.companyId=a,n.get(r,function(a){"false"!=a.error&&0!=a.error||(e.branchsList=a.data)})},e.initNumber=function(a){for(var r=new Array,t=1;t<=10&&t<=a;t++)r.push(t);e.paginationBars=r},e.queryIndex=function(a){(a<=0||a>e.totalPage)&&e.totalPage>0||(e.currentPage=a,u())},e.exp=function(){if(!e.selectedCompany)return void alert("请选择公司！");if(!e.selectedBranch)return void alert("请选择校区！");if(confirm("确定要导出?")){var a="?selectedCompany="+e.selectedCompany+"&selectedBranch="+e.selectedBranch+"&isWfd="+$("#isWfd").prop("checked");window.open("excels/output/outExcelLeftcoursetimes"+a,"_blank")}},o(),c(),u()}angular.module("ework-ui").directive("block",["$compile",function(e){return{restrict:"E",template:"",transclude:!0}}]).controller("LeftCourseTimesCtrl",["$scope","$log","$state","CompanyService","BranchsService","ReportService",LeftCourseTimesCtrl]);
function newRetreatTurnCtrl(e,a,t,r,n,i){function o(){var a=new Array;if(e.currentPage==e.totalPage){for(var t=e.totalPage-9,r=t<0?1:t,n=r;n<=e.totalPage;n++)a.push(n);e.paginationBars=a}else if(1==e.currentPage)e.initNumber(e.totalPage);else{var i=e.paginationBars.length,o=e.paginationBars[i-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(i,1)):e.currentPage>o&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(i-1,0,o+1))}}function c(){n.get({},function(a){"false"==a.error&&(a.data.unshift({id:"-1",name:"全部"}),e.branchsList=a.data,e.selectedBranch=e.branchsList[0])})}function s(){r.get({},function(a){"false"==a.error&&(a.data.unshift({id:"-1",name:"全部"}),e.companys=a.data,e.selectedCompany=e.companys[0])})}function l(){if(!e.selectedCompany)return void alert("请选择公司！");if(!e.selectedBranch)return void alert("请选择校区！");if(!e.st)return void alert("开始时间必须录入！");if(!e.dt)return void alert("截止时间必须录入！");var t={};t.rows=9,t.pageSize=e.pageSize,t.currentPage=e.currentPage,t.totalPage=e.totalPage,t.reportType="queryNewRetreatTurn",t.search_info=e.search_info,t.companyId=e.selectedCompany.id,t.branchId=e.selectedBranch.id,t.calcBeginDate=$("#beginDate").val(),t.calcEndDate=$("#endDate").val(),t.isWfd=$("#isWfd").prop("checked"),e.isLoadingOrders="loading...",e.reportData=[],i.query(t,function(t){e.reportData=t.data,e.currentPage=t.currentPage,e.totalPage=t.totalPage,o(),e.pageSize=t.pageSize,a.log("pageSize is"+e.pageSize+",totalPage is "+e.totalPage+",currentPage"+e.currentPage),e.isLoadingOrders=""},function(a){alert("异常:"+a.data.message+"请联系管理员！"),e.isLoadingOrders=""})}e.companys=[],e.reportData=[],e.st=new Date,e.dt=new Date,e.search_info="",e.queryInfo=function(){l()},e.getNumber=function(e){for(var a=new Array,t=0;t<e;t++)a.push(t+1);return a},e.initNumber=function(a){for(var t=new Array,r=1;r<=10&&r<=a;r++)t.push(r);e.paginationBars=t},e.queryIndex=function(a){(a<=0||a>e.totalPage)&&e.totalPage>0||(e.currentPage=a,l())},e.exp=function(){if(!e.selectedCompany)return void alert("请选择公司！");if(!e.selectedBranch)return void alert("请选择校区！");if(!e.st)return void alert("开始时间必须录入！");if(!e.dt)return void alert("截止时间必须录入！");if(confirm("确定要导出?")){var a="?companyId="+e.selectedCompany.id+"&branchId="+e.selectedBranch.id+"&isWfd="+$("#isWfd").prop("checked")+"&calcBeginDate="+$("#beginDate").val()+"&calcEndDate="+$("#endDate").val();window.open("excels/output/outExcelNewRetreatTurn"+a,"_blank")}},s(),c()}angular.module("ework-ui").directive("block",["$compile",function(e){return{restrict:"E",template:"",transclude:!0}}]).controller("newRetreatTurnCtrl",["$scope","$log","$state","CompanyService","BranchsService","ReportService",newRetreatTurnCtrl]);
function OrdersCtrl(e,r,a,n,t,o){function c(){var r=new Array;if(e.currentPage==e.totalPage){for(var a=e.totalPage-9,n=a<0?1:a,t=n;t<=e.totalPage;t++)r.push(t);e.paginationBars=r}else if(1==e.currentPage)e.initNumber(e.totalPage);else{var o=e.paginationBars.length,c=e.paginationBars[o-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(o,1)):e.currentPage>c&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(o-1,0,c+1))}}function i(){n.get(function(r){"false"!=r.error&&0!=r.error||(e.companys=r.data)})}function u(e){var r={};r.status=0==e.sync?1:0,e.id&&(r.orderId=e.id),e.orderCourseId&&(r.orderCourseId=e.orderCourseId),t.sync(r,function(a){e.orderId=null,e.sync=r.status,0==a.error||"undefined"==typeof a.error?alert("操作成功!"):alert("当前操作的订单未找到归属公司!")})}function s(){var r={};r.pageSize=e.pageSize,r.currentPage=e.currentPage,r.page=e.currentPage,r.totalPage=e.totalPage,r.p_searchInfo=e.search_info,e.isLoadingOrders="loading...",e.orderData=[],t.get(r,function(r){e.orderData=r.data,e.currentPage=r.currentPage,e.totalPage=r.totalPage,e.pageSize=r.pageSize,c(),e.isLoadingOrders=""})}function d(){var r="";e.search_info&&(r+="?searchInfo="+e.search_info),window.open("excels/output/orders_01"+r,"_blank")}e.companys=[],e.orderData=[],e.checkAll=!1,e.search_info="",e.currentCourse={},e.paginationBars=[],e.initPageNumber=!1,e.selectCompany=function(a){var n=new Array,o=[];if($.each(e.orderData,function(e,r){r.checked&&(r.company_name?o.push(r.id):n.push(r.id))}),n.length||o.length){var c={};c.orders=n,c.updateOrders=o,c.companyId=a.id,t.comments(c,function(r){"false"!=r.error&&0!=r.error||(alert("批注成功！"),e.queryIndex(e.currentPage))},function(e){alert("error found!"),r.log(e)})}else alert("请选择订单！")},e.checkAllOrder=function(){e.checkAll?($.each(e.orderData,function(e,r){r.checked=!1}),e.checkAll=!1):($.each(e.orderData,function(e,r){r.checked=!0}),e.checkAll=!0)},e.checkOrder=function(r){r.checked?r.checked=!1:r.checked=!0;var a=!0;$.each(e.orderData,function(e,r){r.checked||(a=!1)}),e.checkAll=a},e.queryInfo=function(){s()},e.showDetail=function(e){$("#orderDetailsCapacity").modal("show")},e.queryERPStudentList=function(r){e.currentCourse.courseId=r.courseId,$("#myModal").modal("show")},e.queryPUBStudentList=function(r){e.currentCourse.courseId=r.courseId,$("#myModal2").modal("show")},e.orderSync=function(e){u(e)},e.initNumber=function(r){for(var a=new Array,n=1;n<=10&&n<=r;n++)a.push(n);e.paginationBars=a},e.queryIndex=function(r){(r<=0||r>e.totalPage)&&e.totalPage>0||(e.currentPage=r,e.queryInfo())},e.exports=function(){d()},i(),s()}angular.module("ework-ui").directive("block",["$compile",function(e){return{restrict:"E",template:"",transclude:!0}}]).controller("OrdersCtrl",["$scope","$log","$state","CompanyService","OrdersService","OrderCoursesService",OrdersCtrl]);
function EBOrders2OrdersCtrl(e,a,t,r,c,s,n,u,o,i,d,l,y,f,p){function h(e){e.actual_price=e.unit_price,e.discount_sum_price=e.unit_price*e.selectedCourseTimes}function m(a){var t=0;angular.forEach(e.selectedCourseList,function(r){r.id+""==a.id+""&&$.extend(e.selectedCourseList[t],a),parseInt(t++)})}function P(a){var t={};t.companyId=a,c.get(t,function(a){e.isLoadingBranchListSelected="","false"==a.error&&(e.branchsList=a.data)})}function L(){r.get({},function(a){"false"==a.error&&(e.companyList=a.data)})}function _(){c.get({},function(a){"false"==a.error&&(e.branchsList=a.data)})}function C(){var a={};a.searchInfo=e.page.searchInfo,s.get(a,function(a){"false"==a.error&&(e.studentList=a.data)})}function v(){var a={};e.shcId&&null!=e.shcId&&(a.schId=e.shcId),n.get(a,function(a){"false"==a.error&&(e.gradeList=a.data)})}function I(){var a={};e.shcId&&null!=e.shcId&&(a.schId=e.shcId),u.get(a,function(a){"false"==a.error&&(e.seasonList=a.data)})}function S(){var a={};e.shcId&&null!=e.shcId&&(a.schId=e.shcId),o.get(a,function(a){"false"==a.error&&(e.subjectList=a.data)})}function g(){w(),I(),v(),S(),q()}function T(){var a={};$.extend(a,e.queryCourseParam),e.selectingCourseList=[],i.get(a,function(a){if("false"==a.error){var t=a.data;t&&t.length&&$.each(t,function(a,t){t.actual_price=t.unit_price;var r=!1;$.each(e.selectedCourseList,function(e,a){t.id==a.id&&(r=!0)}),r||e.selectingCourseList.push(t)})}})}function k(){var a=0;e.sum_price=0,$.each(e.selectedCourseList,function(e,t){t.discount_sum_price&&(a+=parseFloat(t.discount_sum_price))}),e.sum_price=a.toFixed(2)}function A(){var a=b(),t={};t.studentId=a.id,d.get(t,function(a){"false"==a.error&&(e.account[e.queryCourseParam.productId]=a)})}function b(){var a=null;return $.each(e.studentList,function(e,t){t.checked&&(a=t)}),a}function O(){l.get({},function(a){"false"==a.error&&(e.productList=a.data,e.productList&&e.productList.length&&(e.queryCourseParam.productId=e.productList[0].id))})}function q(){var a={};a.branchId=e.queryCourseParam.branchId,y.get(a,function(a){"false"==a.error&&(e.posList=a.data)})}function w(){var a={};a.branchId=e.queryCourseParam.branchId,f.get(a,function(a){"false"==a.error&&(e.accountList=a.data)})}function N(e,a){angular.forEach(e.courseTimes,function(e){e.checked&&a.push({times:e.time,isValid:1})})}function x(){var a="";for(var t in e.selectedCourseList)if(0==e.selectedCourseList[t].selectedCourseTimes){a=e.selectedCourseList[t].courseName;break}return a}function E(a,t){var r={};e.selectedStudent=b(),r.studentId=e.selectedStudent.id,r.courseId=t,p.query(r,function(t){if(e.isLoadingBranchListSelected="","false"==t.error){var r=t.data;for(var c in r)a.courseTimes[parseInt(r[c].times)-1].disabled=!0,a.courseTimes[parseInt(r[c].times)-1].checked=!1;var s=a.courseTimes.length-r.length;$.extend(a,{selectedCourseTimes:s}),a.discount_sum_price=a.unit_price*a.selectedCourseTimes}})}e.studentList=[],e.selectedCourseList=[],e.courseTimeList=[],e.step=1,e.gradeList=[],e.seasonList=[],e.subjectList=[],e.companyList=[],e.branchsList=[],e.productList=[],e.accountList=[],e.cashList=[],e.cardList=[],e.transferList=[],e.shcId=null,e.page={searchInfo:null},e.checkAll={checkd:!1},e.pay={cash:0,card:0,transfer:0,account:0,sum_price:0},e.payIds=1,e.account={1:{}},e.queryCourseParam={},e.checkCondition=function(t,r){e.queryCourseParam[t]=r,"companyId"==t?(a.log("start query branc.hs.........."+r),P(r)):"branchId"==t&&(e.shcId=r,a.log("start query branchs..........."+r),g()),T()},e.updateOrderCourseTimes=function(e){$("#selectedCourseTimesPanel").modal("hide")},e.selectedStudent=function(a){angular.forEach(e.studentList,function(t){if(a.id==t.id)return t.checked=!0,void(e.curStudent=a)}),e.onGoingQuery=!1},e.toggleAll=function(a){e.checkAll.checked=!e.checkAll.checked;var t=0;e.checkAll.checked||(a.selectedCourseTimes=0),$.each(a.courseTimes,function(a,r){r.disabled||(r.checked=e.checkAll.checked,r.checked&&t++)}),a.courseTimes&&(a.selectedCourseTimes=t),h(e.currentCourse),m(e.currentCourse),k()},e.checkedRow=function(a){if(a.checked){a.checked=!1;var t=e.currentCourse.selectedCourseTimes;e.currentCourse.selectedCourseTimes=parseInt(t-1)}else{a.checked=!0;var t=e.currentCourse.selectedCourseTimes;e.currentCourse.selectedCourseTimes=0==t?1:parseInt(t+1)}h(e.currentCourse),m(e.currentCourse),k()},e.toChangeCourseTimes=function(a){e.currentCourse=a,$("#selectedCourseTimesPanel").modal("show")},e.selectedCourse=function(a){var t=a.id;e.initCourseTimes(a),E(a,t),e.selectedCourseList.push(a),T(),e.onGoingQueryCourse=!1},e.removeCourse=function(a){var t=[];$.each(e.selectedCourseList,function(e,r){r.id!=a.id&&t.push(r)}),e.selectedCourseList=t,T()},e.queryCourse=function(){T()},e.queryStudent=function(){C()},e.queryStudentOnChange=function(){e.onGoingQuery=!0,C()},e.curStudent=null,e.initCourseTimes=function(e){for(var a=0,t=new Array,r=1;r<=e.courseTime;r++)t.push({id:r,time:parseInt(r),checked:!0,disabled:!1});$.extend(e,{courseTimes:JSON.parse(JSON.stringify(t)),selectedCourseTimes:a})},e.checkedStudent=function(a){a.checked?(a.checked=!1,e.curStudent&&e.curStudent.id==a.id&&(e.curStudent=null)):(e.curStudent&&e.curStudent.id!=a.id&&(e.curStudent.checked=!1),a.checked=!0,e.curStudent=a)},e.nextStep=function(a,t){e.step=t,4==t&&(k(),A())},e.toSelectedCourseState="courseUp",e.toSelectedCourse=function(){"courseUp"==e.toSelectedCourseState?e.toSelectedCourseState="courseDown":e.toSelectedCourseState="courseUp"},e.openPayPanel=function(a){"cash"==a?(e.selectedStudent=b(),e.cashPay={total:0,cashList:[]},e.pay.cashList&&(e.cashPay.cashList=e.pay.cashList,e.cashPay.total=e.pay.cash),$("#studentAccountCashPanel").modal("show")):"card"==a?(e.selectedStudent=b(),e.cardPay={total:0,cardList:[],posList:e.posList},e.pay.cardList&&(e.cardPay.cardList=e.pay.cardList,e.cardPay.total=e.pay.card),$("#studentAccountCardPanel").modal("show")):"transfer"==a?(e.selectedStudent=b(),e.transferPay={total:0,transferList:[],accountList:e.accountList},e.pay.transferList&&(e.transferPay.transferList=e.pay.transferList,e.transferPay.total=e.pay.transfer),$("#studentAccountTransferPanel").modal("show")):"account"==a&&(e.selectedStudent=b(),e.accountPay={total:0},e.pay.account&&(e.accountPay.total=e.pay.account),$("#studentAccountPanel").modal("show")),e.pay.currType=a},e.addPay=function(){if(e.payIds+=1,"cash"==e.pay.currType){var t={};t.value=e.cashPay.value,t.remark=e.cashPay.remark,t.type="1",t.typeName="现金",t.id=e.payIds,e.cashPay.cashList.push(t),e.cashPay.value=null,e.cashPay.remark=null,e.cashPay.total=0,$.each(e.cashPay.cashList,function(a,t){e.cashPay.total+=parseInt(t.value)})}else if("card"==e.pay.currType){var r={};r.value=e.cardPay.value,r.card=e.cardPay.card,r.companyAccount=e.cardPay.companyAccount,r.posId=e.cardPay.pos.id,r.posName=e.cardPay.pos.name,r.remark=e.cardPay.remark,r.id=e.payIds,r.type="2",e.cardPay.cardList.push(r),e.cardPay.total=0,$.each(e.cardPay.cardList,function(a,t){e.cardPay.total+=parseInt(t.value)}),a.log("added cash.")}else if("transfer"==e.pay.currType){var c={};a.log(e.transferPay.account),c.value=e.transferPay.value,c.card=e.transferPay.card,c.companyAccount=e.transferPay.account.name,c.accountId=e.transferPay.account.id,c.remark=e.transferPay.remark,c.type="3",c.id=e.payIds,e.transferPay.transferList.push(c),e.transferPay.total=0,$.each(e.transferPay.transferList,function(a,t){e.transferPay.total+=parseInt(t.value)})}},e.removePay=function(a){if("cash"==e.pay.currType){var t=[];e.cashPay.total=0,$.each(e.cashPay.cashList,function(r,c){a.id!=c.id&&(t.push(c),e.cashPay.total+=parseInt(c.value))}),e.cashPay.cashList=t}else if("card"==e.pay.currType){var t=[];e.cardPay.total=0,$.each(e.cardPay.cardList,function(r,c){a.id!=c.id&&(t.push(c),e.cardPay.total+=parseInt(c.value))}),e.cardPay.cardList=t}else if("transfer"==e.pay.currType){var t=[];e.transferPay.total=0,$.each(e.transferPay.transferList,function(r,c){a.id!=c.id&&(t.push(c),e.transferPay.total+=parseInt(c.value))}),e.transferPay.transferList=t}e.cashPay.cashList&&(e.cashList=e.cashPay.cashList),e.cardPay.cardList&&(e.cardList=e.cardPay.cardList),e.transferPay.transferList&&(e.transferList=e.transferPay.transferList)},e.selectedPos=function(a){e.cardPay.companyAccount=a.accountName,e.cardPay.accountId=a.accountId,e.cardPay.posName=a.name,e.cardPay.posId=a.id},e.selectedAccount=function(a){e.transferPay.companyAccount=a.name,e.transferPay.accountId=a.id},e.confirmPay=function(){"cash"==e.pay.currType?(e.pay.cash=e.cashPay.total,e.pay.cashList=e.cashPay.cashList,e.cashPay={},e.cashPay.total=0,$("#studentAccountCashPanel").modal("hide")):"card"==e.pay.currType?(e.pay.card=e.cardPay.total,e.pay.cardList=e.cardPay.cardList,e.cardPay={},e.cardPay.total=0,$("#studentAccountCardPanel").modal("hide")):"transfer"==e.pay.currType?(e.pay.transfer=e.transferPay.total,e.pay.transferList=e.transferPay.transferList,e.transferPay={},e.transferPay.total=0,$("#studentAccountTransferPanel").modal("hide")):"account"==e.pay.currType&&(e.pay.account=e.accountPay.total,e.accountPay={},e.accountPay.total=0,$("#studentAccountPanel").modal("hide"))},e.submitOrder=function(){var a=x();if(""!=a)return alert(a+"未选择报班课次!"),!1;var t={};t.student=e.selectedStudent=b(),t.courseList=e.selectedCourseList,t.pay=e.pay;var r={};p.add(e.genOrderInfo(t,r),function(e){"false"==e.error&&(alert("提交成功！"),location.href="#/businessSystem/orderMgr")})},e.dynamicQueryCourse=function(){e.dynamicQuery=!0,e.queryCourseParam.searchInfo=$("#courseSearchInfo").val(),a.log(e.queryCourseParam),e.onGoingQueryCourse=!0,T()},e.genOrderInfo=function(a,t){var r={};r.student_id=a.student.id,r.sch_id=e.shcId,r.fee_amount=e.sum_price,r.actural_amount=e.sum_price,r.branch_id=e.sch_id;var c=[];return $.each(a.courseList,function(e,a){var t=a.selectedCourseTimes,s=new Array;N(a,s),c.push({course_id:a.id,course_no:a.courseNo,course_name:a.courseName,former_unit_price:a.unit_price,former_sum_price:a.unit_price*t,discount_unit_price:a.actual_price,discount_sum_price:a.discount_sum_price,discount_rate:a.discount_rate,manage_fee:a.manage_fee,discount_amount:a.unit_price*t,course_surplus_count:t,course_total_count:t,surplus_cost:t*a.unit_price,branch_id:r.sch_id,status:1,sch_id:r.sch_id,orderCourseTimes:JSON.parse(JSON.stringify(s))})}),t.order=r,t.order.orderCourseList=c,e.genPayInfo(t),t},e.genPayInfo=function(a){var t={};t.pay_cash=e.pay.cash,t.pay_card=e.pay.card,t.pay_trans=e.pay.transfer,t.pay_account=e.pay.account;var r=new Array,c=e.queryCourseParam.companyId;e.pay.cashList&&$.each(e.pay.cashList,function(e,a){r.push({company_id:c,client_card_no:null,company_card_no:null,fee_amount:a.value,pay_way:1})}),e.pay.cardList&&$.each(e.pay.cardList,function(e,a){r.push({company_id:c,client_card_no:a.card,company_card_no:a.posId,fee_amount:a.value,pay_way:2})}),e.pay.transferList&&angular.forEach(e.pay.transferList,function(e){r.push({company_id:c,client_card_no:e.card,company_card_no:e.accountId,fee_amount:e.value,pay_way:3})}),t.details=JSON.parse(JSON.stringify(r)),a.payInfo=t},e.changeCoursePrice=function(e){e.actual_price=Math.floor(e.discount_sum_price/e.selectedCourseTimes),e.manage_fee=e.discount_sum_price%e.selectedCourseTimes,e.discount_rate=parseFloat(e.actual_price/e.unit_price),e.discount_rate=e.discount_rate.toFixed(2),k()},C(),v(),I(),S(),L(),_(),O(),q(),w()}angular.module("ework-ui").controller("EBOrders2OrdersCtrl",["$scope","$log","$state","CompanyService","BranchsService","StudentQueryService","GradeService","SeasonService","SubjectService","CourseService","StudentAccountService","ProductService","PosService","CompanyAccountService","OrdersPubService",EBOrders2OrdersCtrl]);
function EBOrdersCtrl(e,a,r,t,n,o){function s(){t.get({},function(a){"false"==a.error&&(e.companyList=a.data)})}function c(){var a={};e.searchPage.selectedCompany&&(a.companyId=e.searchPage.selectedCompany),n.get(a,function(a){"false"==a.error&&(e.branchsList=a.data)})}function i(){var r={};r.pageSize=e.pageSize,r.currentPage=e.currentPage,r.totalPage=e.totalPage,r.p_searchInfo=e.search_info,e.searchPage.selectedCompany&&(r.p_selectedCompany=e.searchPage.selectedCompany),e.searchPage.selectedBranch&&(r.p_selectedBranch=e.searchPage.selectedBranch),e.searchPage.startDate&&(r.p_startDate=$("#startDate").val()),e.searchPage.endDate&&(r.p_endDate=$("#endDate").val()),e.isLoadingOrders="loading...",e.orderData=[],a.log("param="+e.searchPage.selectedBranch),o.get(r,function(r){r.message?alert(r.message):"false"==r.error&&(a.log(r.data[0].actural_amount),e.orderList=r.data,l(e.orderList),e.currentPage=r.currentPage,e.totalPage=r.totalPage,e.pageSize=r.pageSize),u(),e.isLoadingOrders=""})}function l(e){angular.forEach(e,function(e){var a=0;angular.forEach(e.orderCourseList,function(e){a+=e.course_total_count,a=parseInt(a)}),$.extend(e,{courseTimes:a})})}function g(a){var r={};r.orderId=a.id,o.queryDetails(r,function(a){"false"==a.error&&(e.currentOrder.payFees=a.payFees,e.currentOrder.transfers=a.transfers,e.currentOrder.attendances=a.attendances)})}function u(){var a=new Array;if(e.currentPage==e.totalPage){for(var r=e.totalPage-9,t=r<0?1:r,n=t;n<=e.totalPage;n++)a.push(n);e.paginationBars=a}else if(1==e.currentPage)e.initNumber(e.totalPage);else{var o=e.paginationBars.length,s=e.paginationBars[o-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(o,1)):e.currentPage>s&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(o-1,0,s+1))}}e.companyList=[],e.branchsList=[],e.orderList=[],e.currentPage=1,e.totalPage=1,e.pageSize=20,e.searchPage={selectedCompany:null,selectedBranch:null,startDate:null,endDate:null},e.queryOrderInfo=function(){i()},e.orderCancel=function(e){var a={};a.orderId=e.id,o.delete(a,function(e){"false"==e.error?alert("已成功作废！"):alert("作废失败:"+e.message)})},e.queryBranchs=function(){c()},e.queryInfo=function(){i()},e.initNumber=function(a){for(var r=new Array,t=1;t<=10&&t<=a;t++)r.push(t);e.paginationBars=r},e.queryIndex=function(a){(a<=0||a>e.totalPage)&&e.totalPage>0||(e.currentPage=a,e.queryInfo())},e.showDetails=function(a){e.currentOrder=a,g(a),e.orderDetails=a.orderCourseList,$("#orderDetailsCapacity").modal("show")},s(),c(),i()}angular.module("ework-ui").controller("EBOrdersCtrl",["$scope","$log","$state","CompanyService","BranchsService","OrdersPubService",EBOrdersCtrl]);
function RechargeAndEnchashmentCtrl(e,a,t,n,r,i){function o(){r.get({},function(a){"false"==a.error&&(a.data.unshift({id:"-1",name:"全部"}),e.branchsList=a.data,e.selectedBranch=e.branchsList[0])})}function c(){n.get({},function(a){"false"==a.error&&(a.data.unshift({id:"-1",name:"全部"}),e.companys=a.data,e.selectedCompany=e.companys[0])})}function s(){var a=new Array;if(e.currentPage==e.totalPage){for(var t=e.totalPage-9,n=t<0?1:t,r=n;r<=e.totalPage;r++)a.push(r);e.paginationBars=a}else if(1==e.currentPage)e.initNumber(e.totalPage);else{var i=e.paginationBars.length,o=e.paginationBars[i-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(i,1)):e.currentPage>o&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(i-1,0,o+1))}}function g(){if(!e.selectedCompany)return void alert("请选择公司！");if(!e.selectedBranch)return void alert("请选择校区！");if(!e.st)return void alert("开始时间必须录入！");if(!e.dt)return void alert("截止时间必须录入！");var t={};t.pageSize=e.pageSize,t.rows=9,t.currentPage=e.currentPage,t.totalPage=e.totalPage,t.search_info=e.search_info,t.reportType="queryRechargeAndEnchashment",e.isLoadingOrders="loading...",t.companyId=e.selectedCompany.id,t.branchId=e.selectedBranch.id,t.calcBeginDate=$("#beginDate").val(),t.calcEndDate=$("#endDate").val(),e.reportData=[],i.query(t,function(t){e.reportData=t.data,e.currentPage=t.currentPage,e.totalPage=t.totalPage,e.pageSize=t.pageSize,s(),a.log("pageSize is"+e.pageSize+",totalPage is "+e.totalPage+",currentPage"+e.currentPage),e.isLoadingOrders=""},function(a){alert("异常:"+a.data.message+"请联系管理员！"),e.isLoadingOrders=""})}e.companys=[],e.reportData=[],e.st=new Date,e.dt=new Date,e.format="yyyy-MM-dd",e.selectedCompany=-1,e.selectedBranch=-1,e.search_info="",e.queryInfo=function(){e.currentPage=1,g()},e.getNumber=function(e){for(var a=new Array,t=0;t<e;t++)a.push(t+1);return a},e.initNumber=function(a){for(var t=new Array,n=1;n<=10&&n<=a;n++)t.push(n);e.paginationBars=t},e.queryIndex=function(a){(a<=0||a>e.totalPage)&&e.totalPage>0||(e.currentPage=a,g())},e.exp=function(){if(!e.selectedCompany)return void alert("请选择公司！");if(!e.selectedBranch)return void alert("请选择校区！");if(!e.st)return void alert("开始时间必须录入！");if(!e.dt)return void alert("截止时间必须录入！");if(confirm("确定要导出?")){var a="?companyId="+e.selectedCompany.id+"&branchId="+e.selectedBranch.id+"&calcBeginDate="+$("#beginDate").val()+"&calcEndDate="+$("#endDate").val();window.open("excels/output/outExcelRechargeandenchashment"+a,"_blank")}},c(),o()}angular.module("ework-ui").directive("block",["$compile",function(e){return{restrict:"E",template:"",transclude:!0}}]).controller("RechargeAndEnchashmentCtrl",["$scope","$log","$state","CompanyService","BranchsService","ReportService",RechargeAndEnchashmentCtrl]),Date.prototype.Format=function(e){var a={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var t in a)new RegExp("("+t+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?a[t]:("00"+a[t]).substr((""+a[t]).length)));return e};
function RechargesCtrl(e,a,r,n,t){function c(){var a=new Array;if(e.currentPage==e.totalPage){for(var r=e.totalPage-9,n=r<0?1:r,t=n;t<=e.totalPage;t++)a.push(t);e.paginationBars=a}else if(1==e.currentPage)e.initNumber(e.totalPage);else{var c=e.paginationBars.length,o=e.paginationBars[c-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(c,1)):e.currentPage>o&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(c-1,0,o+1))}}function o(){n.get({},function(a){"false"!=a.error&&0!=a.error||(e.companys=a.data)})}function i(){var a={};a.pageSize=e.pageSize,a.currentPage=e.currentPage,a.page=e.currentPage,a.totalPage=e.totalPage,a.p_searchInfo=e.search_info,e.isLoadingRechargesData="loading...",e.rechargesData=[],t.get(a,function(a){"false"!=a.error&&0!=a.error||(e.rechargesData=a.data,e.currentPage=a.currentPage,e.page=a.currentPage,e.totalPage=a.totalPage,e.pageSize=a.pageSize,c()),e.isLoadingRechargesData=""})}function g(){var a="";e.search_info&&(a+="?searchInfo="+e.search_info),window.open("excels/output/recharges_01"+a,"_blank")}e.companys=[],e.initPageNumber=!1,e.paginationBars=[],e.selectCompany=function(r){var n=[],c=[];if($.each(e.rechargesData,function(e,a){a.checked&&(a.company_name?c.push(a.id):n.push(a.id))}),n.length||c.length){var o={};o.recharges=n,o.companyId=r.id,o.updateRecharges=c,t.post(o,function(a){"false"!=a.error&&0!=a.error||(alert("提交成功！"),e.queryIndex(e.currentPage))},function(e){alert("error found!"),a.log(e)})}else alert("请选择订单！")},e.checkAllRows=function(){e.checkAll?($.each(e.rechargesData,function(e,a){a.checked=!1}),e.checkAll=!1):($.each(e.rechargesData,function(e,a){a.checked=!0}),e.checkAll=!0)},e.check=function(a){a.checked?a.checked=!1:a.checked=!0;var r=!0;$.each(e.rechargesData,function(e,a){a.checked||(r=!1)}),e.checkAll=r},e.timing=function(r){var n={};n.rechargeId=r.id,a.log("rechargeId="+n.rechargeId),t.rechargeTiming(n,function(a){"false"!=a.error&&0!=a.error||(alert("操作成功！"),e.queryIndex(e.currentPage))},function(e){alert("error found!"),a.log(e)})},e.initNumber=function(a){for(var r=new Array,n=1;n<=10&&n<=a;n++)r.push(n);e.paginationBars=r},e.queryInfo=function(){i()},e.showDetail=function(e){e.showDetail?e.showDetail=!1:e.showDetail=!0},e.queryIndex=function(a){(a<=0||a>e.totalPage)&&e.totalPage>0||(e.currentPage=a,e.queryInfo())},e.exports=function(){g()},o(),i()}angular.module("ework-ui").controller("RechargesCtrl",["$scope","$log","$state","CompanyService","RechargesService",RechargesCtrl]);
function ScheduleCtrl(e,t,a,r,n,s,c,o,i,u,d){function l(t){e.studentsList&&e.studentsList.length>0&&$.each(e.studentsList,function(a,r){mode.id==t&&(e.studentScheduleList=r.conflictSchdules)})}function g(t){var a={};a.courseId=t.id,"courseDate"in t?(a.startDate=t.courseDate,a.endDate=t.courseDate):"courseBeginDate"in t&&(a.startDate=t.courseBeginDate,a.endDate=t.courseBeginDate),t.startTime&&(a.startTime=t.startTime),t.endTime&&(a.endTime=t.endTime),e.studentsList=[],e.studentListLoading="loading...",u.queryPostData(a,function(t){"false"==t.error&&(e.studentsList=t.data),e.studentListLoading=""})}function h(t){var a={};a.teacherId=t.teacher_id,o.get(a,function(a){"false"==a.error&&(e.teacherScheduleList=a.data,f(a.data,t))})}function f(e,t){t.scheduleConflict=!1;var a=t.courseBeginDate?t.courseBeginDate+" "+t.startTime:t.courseDate+" "+t.startTime,r=t.courseEndDate?t.courseEndDate+" "+t.endTime:t.courseDate+" "+t.endTime;a=new Date(a),r=new Date(r);var n=60*a.getHours()+a.getMinutes(),s=60*r.getHours()+r.getMinutes();$.each(e,function(c,o){if(o.id!=t.id){var i=new Date(o.startDate),u=new Date(o.endDate),d=60*i.getHours()+i.getMinutes(),l=60*u.getHours()+u.getMinutes();i>=a&&i<=r&&d>=n&&d<=s&&(o.state=1),u>=a&&u<=r&&l>=n&&l<=s&&(o.state=1),t.scheduleConflict=1==o.state,e[c].scheduleConflict=1==o.state,e[c].stateInfo=1==o.state?"上课冲突":""}})}function m(){return e.studentsList&&e.studentsList.length>0&&$.each(e.studentsList,function(e,t){if(mode.id==studentId&&t.conflictSchdules&&t.conflictSchdules.lenth>0)return!0}),!1}function D(){var t={};t.pageSize=e.pageSize,t.currentPage=e.currentPage,t.totalPage=e.totalPage,t.p_searchInfo=e.search_info,e.selectedBranch&&(t.p_selectedBranch=e.selectedBranch.id),e.selectedCompany&&(t.p_selectedCompany=e.selectedCompany.id),e.selectedBranch&&(t.p_selectedBranch=e.selectedBranch.id),e.courseInfoList=[],e.isLoadingCourses="loading...",r.get(t,function(t){"false"==t.error&&(e.courseInfoList=t.data,e.currentPage=t.currentPage,e.totalPage=t.totalPage,e.pageSize=t.pageSize,L(e)),e.isLoadingCourses=""})}function p(){n.get({},function(t){"false"!=t.error&&0!=t.error||(e.companyList=t.data)})}function P(){s.get({},function(t){"false"!=t.error&&0!=t.error||(e.branchsList=t.data)})}function S(){var a={};$.extend(a,e.teacherPage),a.p_teacher_search_info=e.teacherPage.teacher_search_info,t.log(e.teacherPage.teacher_search_info),e.isteacherListLoading="loading...",c.get(a,function(t){"false"==t.error&&(e.teacherList=t.data,e.teacherPage.currentPage=t.currentPage,e.teacherPage.totalPage=t.totalPage,e.teacherPage.pageSize=t.pageSize,L(e.teacherPage)),e.isteacherListLoading=""})}function C(e){return h(e),m(),e.scheduleConflict}function T(t){var a={};a.courseId=t.id,e.isLoadingCourseTimes="loading...",i.get(a,function(a){"false"==a.error&&(t.courseTimeList=a.data),e.isLoadingCourseTimes=""})}function L(e){var t=new Array;if(e.currentPage==e.totalPage){for(var a=e.totalPage-9,r=a<0?1:a,n=r;n<=e.totalPage;n++)t.push(n);e.paginationBars=t}else if(1==e.currentPage){for(var n=1;n<=e.pageSize&&n<=e.totalPage;)t.push(n),n++;e.paginationBars=t}else{var s=e.paginationBars.length,c=e.paginationBars[s-1];e.currentPage<e.paginationBars[0]?(e.paginationBars.splice(0,0,e.paginationBars[0]-1),e.paginationBars.splice(s,1)):e.currentPage>c&&e.currentPage<e.totalPage&&(e.paginationBars.splice(0,1),e.paginationBars.splice(s-1,0,c+1))}}e.courseInfoList=[],e.currentCourse={},e.companyList=[],e.branchsList=[],e.teacherList=[],e.studentsList=[],e.currentPage=1,e.totalPage=1,e.pageSize=20,e.selectedBranch=null,e.paginationBars=[],e.initPageNumber=!1,e.teacherPage={currentPage:1,totalPage:1,pageSize:20,paginationBars:[],teacher_search_info:null,initPageNumber:!1},e.selectedBranch=null,e.selectedCompany=null,e.queryInfo=function(){D()},e.queryERPStudentList=function(t){$("#myModal").modal("show"),e.currentCourse.courseId=t.id},e.queryPUBStudentList=function(t){$("#myModal2").modal("show"),e.currentCourse.courseId=t.id},e.searchTeacher=function(t){$("#teacherSeacher").modal("show"),e.currentCourse=t,S()},e.changeCourse=function(t){e.currentCourse=t,t.courseBeginDate?(e.currentCourse.startDate=t.courseBeginDate,e.currentCourse.endDate=t.courseEndDate):"courseDate"in t&&t.courseDate&&(e.currentCourse.startDate=t.courseDate),$("#selectedCourseInfoPanel").modal("show")},e.queryTeacherList=function(){S()},e.aditCourse=function(e){e.edit=!0},e.saveCourse=function(a){if(C(a))return void alert("教师日常检查存在冲突！");if(m())return void alert("学员日常检查存在冲突！");var n={};n.id=a.id,n.startTime=a.startTime,n.teacherId=a.teacher_id,t.log("teacher_id="+a.teacher_id),n.endTime=a.endTime,a.courseDate&&(n.courseDate=a.courseDate.replace(new RegExp("-","g"),"")),a.courseBeginDate&&(n.courseBeginDate=a.courseBeginDate,n.courseEndDate=a.courseEndDate),r.saveCourse(n,function(t){"false"==t.error||0==t.error?alert("保存成功!"):"false"==t.error&&alert("保存失败"+t.message),e.queryCourseIndex(e.currentPage)}),a.edit=!1},e.comfirmSelectedTeacher=function(){return e.selectedTeacher?(e.currentCourse.tearch_name=e.selectedTeacher.name,e.currentCourse.teacher_id=e.selectedTeacher.id,t.log("techaer_id="+e.selectedTeacher.id),t.log("techaer_name="+e.selectedTeacher.name),$("#teacherSeacher").modal("hide"),void C(e.currentCourse)):void alert("请选择教师！")},e.updatecCourseInfo=function(t){t.courseBeginDate&&(t.courseBeginDate=e.getFormatDate(t.startDate,"yyyy-MM-dd"),t.courseEndDate=e.getFormatDate(t.endDate,"yyyy-MM-dd")),t.courseDate&&(t.courseDate=e.getFormatDate(t.startDate,"yyyy-MM-dd")),t.startDateTime&&(t.startTime=new Date(t.startDateTime).Format("hh:mm")),t.endDateTime&&(t.endTime=new Date(t.endDateTime).Format("hh:mm")),C(e.currentCourse),e.currentCourse=t,$("#selectedCourseInfoPanel").modal("hide")},e.getFormatDate=function(e,t){var a=new Date(e).Format(t);return a},e.showScheduleConflict=function(e){h(e),g(e),$("#scheduleConflictPanel").modal("show")},e.showStudentSchedule=function(t){e.isShowStudentSchedule=!0,l(t.id)},e.concelStudentSchedule=function(){e.isShowStudentSchedule=!1},e.showCourseTimes=function(e){e.showCourseTime?e.showCourseTime=!1:(e.showCourseTime=!0,T(e))},e.checked=function(t){angular.forEach(e.teacherList,function(e){e.checked=!1}),t.checked?(t.checked=!1,e.selectedTeacher=null):(t.checked=!0,e.selectedTeacher=t)},e.queryBranchsWithId=function(a){var r={};r.companyId=a.id,t.log("start query"),t.log(r.companyId),s.get(r,function(t){"false"!=t.error&&0!=t.error||(e.branchsList=t.data)})},e.changeParam=function(t){e.selectedBranch=t},e.queryTeacherIndex=function(t){(t<=0||t>e.teacherPage.totalPage)&&e.totalPage>0||(e.teacherPage.currentPage=t,e.queryTeacherList())},e.queryCourseIndex=function(t){(t<=0||t>e.totalPage)&&e.totalPage>0||(e.currentPage=t,e.queryInfo())},P(),D(),p()}angular.module("ework-ui").controller("ScheduleCtrl",["$scope","$log","$state","CoursesInfoService","CompanyService","BranchsService","TeacherListService","TeacherScheduleService","CourseTimesService","StudentListService","StudentScheduleService",ScheduleCtrl]),Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in t)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[a]:("00"+t[a]).substr((""+t[a]).length)));return e};
function StudentListCtrl(e,t,r,u,o){function n(){null!=e.currentCourse.courseId&&(s(),d())}function s(){var r={};r.courseId=e.currentCourse.courseId,r.type=1,t.log("id===="+e.$parent.currentCourse.courseId),e.ERPCourseStudentQuery="isLoading...",e.ERPCourseStudentList=[],o.get(r,function(t){"false"!=t.error&&0!=t.error||(e.ERPCourseStudentList=t.data),e.ERPCourseStudentQuery=""})}function d(){var r={};r.courseId=e.$parent.currentCourse.courseId,r.type=0,e.PUBCourseStudentList=[],e.PUBCourseStudentQuery="isLoading...",t.log("id===="+e.$parent.currentCourse.courseId),u.get(r,function(t){"false"!=t.error&&0!=t.error||(e.PUBCourseStudentList=t.data),e.PUBCourseStudentQuery=""})}e.ERPCourseStudentList=[],e.PUBCourseStudentList=[],e.$parent.$watch("currentCourse.courseId",function(e){n()})}angular.module("ework-ui").controller("StudentListCtrl",["$scope","$log","$state","PUBCourseStudentListService","ERPCourseStudentListService",StudentListCtrl]);