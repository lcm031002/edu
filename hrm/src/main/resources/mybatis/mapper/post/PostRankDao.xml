<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ebusiness.hrm.dao.PostRankDao">
    
	<insert id="insert" parameterType="com.ebusiness.hrm.model.PostRank">
		INSERT INTO tp_post_rank
		(
			id,
			rank_code,
			remark,
			create_user,
			create_time,
			update_user,
			update_time,
			deleted
		)
		VALUES
		(
			#{id,jdbcType=VARCHAR},
			#{rank_code,jdbcType=VARCHAR},
			#{remark,jdbcType=VARCHAR},
			#{create_user,jdbcType=NUMERIC},
			#{create_time,jdbcType=TIMESTAMP},
			#{update_user,jdbcType=NUMERIC},
			#{update_time,jdbcType=TIMESTAMP},
			0
		)
	</insert>
	
	<update id="update" parameterType="com.ebusiness.hrm.model.PostRank">
		UPDATE tp_post_rank
		SET
			rank_code=#{rank_code,jdbcType=VARCHAR},
			remark=#{remark,jdbcType=VARCHAR},
			update_user=#{update_user,jdbcType=NUMERIC},
			update_time=#{update_time,jdbcType=TIMESTAMP}
		WHERE id=#{id, jdbcType = VARCHAR}
	</update>
	
	<select id="selectSimpleList" resultType="com.ebusiness.hrm.model.PostRank">
		select t.id, t.rank_code, t.remark
		from tp_post_rank t 
		order by t.rank_code
	</select>
	
	<select id="selectList" resultType="com.ebusiness.hrm.model.PostRank">
		select t.id, t.rank_code, t.remark,
			   wm_concat(rel.level_id) as level_ids,
			   wm_concat(pl.level_code) as level_codes
		from tp_post_rank t 
		left join tp_rank_level_rel rel on t.id = rel.rank_id
		left join tp_post_level pl on rel.level_id = pl.id
		group by t.id, t.rank_code, t.remark
		order by t.rank_code
	</select>
	
	<!-- 根据层级Id删除关系 -->
	<delete id="deleteRelByRankId" parameterType="java.lang.String">
		delete from tp_rank_level_rel
		WHERE rank_id=#{rank_id, jdbcType = VARCHAR}
	</delete>
	
	<insert id="insertRankLevelRel" parameterType="java.util.List">
		<foreach collection="list" item="item" index="index" open="begin"
			close="; end;" separator=";">
			insert into tp_rank_level_rel
			(
			id,
			rank_id,
			level_id,
			deleted
			)
			values
			(
			#{item.id},
			#{item.rank_id},
			#{item.level_id},
			0
			)
		</foreach>
	</insert>
	
</mapper>