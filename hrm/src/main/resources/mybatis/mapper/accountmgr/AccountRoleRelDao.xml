<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ebusiness.hrm.dao.AccountRoleRelDao">

	<!-- 根据指定账户查询角色 -->
	<select id="queryRoleWithAccount"  parameterType="Long"  resultType="java.util.Map">
		select ear.role_id as "id" ,trf.role_name as "roleName", ear.id as "accountRoleId"
		  from tab_user_role_ref ear 
		join tab_role_info trf
		on ear.role_id=trf.id
		where ear.user_id=#{user_id,jdbcType =NUMERIC}
		and trf.status=1
	</select>

	<!-- 添加账户角色列表 -->
	<insert id="addAccountRole" parameterType="com.ebusiness.hrm.model.AccountRoleRel">
	   INSERT INTO tab_user_role_ref ( id,user_id,role_id)
	   <!-- 角色列表为录入空结果集 -->
	   <if test="roleList==null || roleList.size==0">
	   SELECT null,null,null from dual where 1=2
	   </if>
	     <if test="roleList!=null and roleList.size>0">
	   SELECT
            seq_tab_user_role_ref.nextval,#{user_id, jdbcType = NUMERIC},t.* from
            (
	 <foreach collection="roleList" item="element" index="index" separator="union" open="(" close=")">
         SELECT
            #{element.id, jdbcType = NUMERIC}
              FROM dual 
        </foreach>
         ) t
         </if>
	</insert>

<!-- 删除账户角色关系 -->
	<delete id="deleteAccountRole" parameterType="Long">
		delete from tab_user_role_ref where user_id=#{user_id,jdbcType = NUMERIC}
	</delete>
	
	<delete id="deleteAccountRoleById" parameterType="Long">
		delete from tab_user_role_ref where id = #{id, jdbcType = NUMERIC}
	</delete>
	
</mapper>