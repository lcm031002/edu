<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ebusiness.hrm.dao.RoleDao">

	<!-- 查询角色信息列表 -->
	<select id="queryRole" parameterType="java.util.Map"
		resultType="com.ebusiness.hrm.model.Role">
		SELECT
		erf.id,
		erf.role_name as roleName,
		erf.status,
		erf.create_time,
		erf.update_time,
		tuf.username as create_user,
		tuif.username as
		update_user
		FROM tab_role_info erf
		left join tab_user_info tuf
		on
		erf.create_user=tuf.id
		left join tab_user_info tuif
		on
		erf.update_user=tuif.id
		where 1=1
		and erf.status != 0
		<if test="roleName!=null and roleName!=''">
			and erf.role_name like
			'%'||#{roleName,jdbcType=VARCHAR}||'%'
		</if>
		<if test="status!=null and status != -1">
			and erf.status=#{status}
		</if>
		<!-- <if test="accountId!=null and accountId!=''"> and not exists( select 
			erf.id from ebs_accountrole_rel ear where ear.roleId=erf.id and ear.accountId=#{accountId,jdbcType 
			=NUMERIC} ) </if> -->
		order by erf.create_time desc
	</select>

	<!-- 添加角色 -->
	<insert id="addRole" parameterType="com.ebusiness.hrm.model.Role">
		<selectKey resultType="java.lang.Long" keyProperty="id"
			order="BEFORE">
			SELECT SEQ_TAB_ROLEINFO.nextval as id FROM dual
		</selectKey>
		INSERT INTO tab_role_info
		(
		id,
		role_name,
		status,
		create_user,
		create_time
		)
		SELECT
		#{id,jdbcType=NUMERIC},
		#{roleName,jdbcType=VARCHAR},
		1,
		#{create_user,jdbcType=NUMERIC},
		(select sysdate from dual)
		from dual
	</insert>

	<!-- 修改角色 -->
	<update id="updateRole" parameterType="Map">
		UPDATE tab_role_info
		<set>
			role_name=#{roleName,jdbcType=VARCHAR},
			update_user=#{update_user,jdbcType=NUMERIC},
			update_time=(select
			sysdate from dual)
		</set>
		<where>
			id=#{id,jdbcType=NUMERIC}
		</where>
	</update>

	<!-- 修改 角色状态 -->
	<update id="changeRoleStatus" parameterType="Long">
		UPDATE tab_role_info erf
		SET erf.status=#{status,jdbcType=NUMERIC}
		WHERE
		erf.id=#{roleId,jdbcType=NUMERIC}
	</update>

	<!-- 查询已存在角色 -->
	<select id="queryRoleId" parameterType="Map" resultType="Long">
		select
		erf.id from tab_role_info erf WHERE
		rownum=1 and
		erf.role_name=#{roleName, jdbcType=VARCHAR}
		<if test="roleId!=null and roleId!=-1">
			and erf.id != #{roleId, jdbcType =NUMERIC}
		</if>
	</select>

</mapper>